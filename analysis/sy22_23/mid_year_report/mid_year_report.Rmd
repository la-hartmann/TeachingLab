---
params:
  partner: "All Sites"
title: "`r paste0('Teaching Lab Mid Year Report: ', params$partner)`"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  TeachingLab::TLDefault:
    css: styles.css
    fontawesome: false
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: false
    highlight: kate # Also can do tango
    number_sections: false
    includes:
      in_header: header.html
      after_body: footer.html
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
na_df <- TeachingLab::na_df
library(ggtext)
library(glue)
library(gt)
library(here)
library(knitr)
library(lubridate)
library(qualtRics)
library(rmdformats)
library(scales)
# devtools::load_all()
library(TeachingLab)
library(tidyverse)
update_data <- FALSE

### IPG Forms Read-In ###
ipg_forms <- qualtRics::fetch_survey(
  surveyID = "SV_0BSnkV9TVXK1hjw",
  verbose = FALSE,
  force = update_data,
  include_display_order = FALSE
) |>
  TeachingLab::neg_cond_filter(
    if_not_this = "All Sites",
    filter_this = params$partner,
    dat_filter = site
  ) |>
  # For Danville
  # filter(!is.na(`Grade Level_9`) | !is.na(`Grade Level_10`) | !is.na(`Grade Level_11`) |
  #              !is.na(`Grade Level_12`) | !is.na(`Grade Level_13`) | !is.na(`Grade Level_14`)) |>
  dplyr::filter(Finished == TRUE)
ipg_count <- nrow(ipg_forms)

### Educator Survey Read-In ###
educator_survey <- qualtRics::fetch_survey(
  surveyID = "SV_8vrKtPDtqQFbiBM",
  verbose = FALSE,
  force_request = update_data,
  include_display_order = FALSE
) |>
  TeachingLab::neg_cond_filter(
    if_not_this = "All Sites",
    filter_this = params$partner,
    dat_filter = site
  ) |>
  # For Danville
  # filter(!is.na(`Grades_8`) | !is.na(`Grades_9`) | !is.na(`Grades_10`) |
  #              !is.na(`Grades_11`) | !is.na(`Grades_12`) | !is.na(`Grades_13`) |
  #              !is.na(`Grades_14`)) |>
  dplyr::filter(Finished == TRUE)
diagnostic_count <- nrow(educator_survey)

### Knowledge Assessments Read-In ###
knowledge_assessments <- readr::read_rds(here::here("data/SY22_23/knowledge_assessments_22_23.rds")) |>
  TeachingLab::neg_cond_filter(
    if_not_this = "All Sites",
    filter_this = params$partner,
    dat_filter = site
  )

pre_know <- nrow(knowledge_assessments |> dplyr::filter(prepost == "pre"))
post_know <- nrow(knowledge_assessments |> dplyr::filter(prepost == "post"))

### Participant Feedback Read In ###
participant_feedback <- qualtRics::fetch_survey(
  surveyID = "SV_djt8w6zgigaNq0C",
  verbose = FALSE,
  force_request = update_data,
  include_display_order = FALSE
) |>
  TeachingLab::neg_cond_filter(
    if_not_this = "All Sites",
    filter_this = params$partner,
    dat_filter = site
  ) |>
  # For Danville
  # filter(!is.na(`Grade level_10`) | !is.na(`Grade level_11`) | !is.na(`Grade level_12`) |
  #              !is.na(`Grade level_13`) | !is.na(`Grade level_14`) | !is.na(`Grade level_15`)) |>
  dplyr::filter(Finished == TRUE)
### Split data into End of Session, End of Course, Ongoing Coaching, and End of Coaching ###
### Initial logic to deal with changes to last session or not at the start of the year ###
if (params$partner %in% c("IL_Kankakee District 111", "CA_San Diego", "TN_McNairy County Schools")) {
  participant_feedback$last_session_or_not <- "Yes - there will be more sessions for this PL course or coaching support."
}
session_survey <- participant_feedback |>
  dplyr::filter(last_session_or_not == "Yes - there will be more sessions for this PL course or coaching support." & course != "Coaching")
course_survey <- participant_feedback |>
  dplyr::filter(last_session_or_not != "Yes - there will be more sessions for this PL course or coaching support." & course != "Coaching")
ongoing_coaching <- participant_feedback |>
  dplyr::filter(last_session_or_not == "Yes - there will be more sessions for this PL course or coaching support." & course == "Coaching")
end_coaching <- participant_feedback |>
  dplyr::filter(last_session_or_not != "Yes - there will be more sessions for this PL course or coaching support." & course == "Coaching")

###################################################################################################

no_data_plot <- ggplot(tibble(text = "No data here - yet!", x = 0, y = 0)) +
  geom_text(aes(label = text, x, y), fontface = "bold", family = "Calibri Bold", size = 10) +
  theme_void()

theme_final_report <- function() {
  theme_tl(legend = T) +
    theme(
      axis.text.x = element_blank(),
      axis.text.y = element_text(
        lineheight = 0.9, size = 12,
        margin = margin(t = 0, l = 0, r = -25, b = 0)
      ),
      strip.text = element_text(
        size = 14, face = "bold", family = "Calibri Bold",
        hjust = 0.5
      ),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.justification = c(0, 1),
      legend.margin = margin(-30, 0, 0, -155),
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 11),
      plot.title = element_text(lineheight = 1.1, size = 18, face = "bold"),
      plot.subtitle = element_text(size = 14, face = "bold")
    )
}

## Global options
options(max.print = "75", width = 1000)
opts_chunk$set(
  echo = FALSE,
  cache = FALSE,
  prompt = FALSE,
  tidy = TRUE,
  comment = NA,
  message = FALSE,
  warning = FALSE
)
```

```{=html}
<script src="js/hideOutput.js"></script>
```
#### 2022-2023 Mid Year Report

### Background

Teaching Lab collects a variety of data to understand the impact of its
PL for educators and students. Please see this
[resource](https://docs.google.com/presentation/d/1Vo844M0_Au8bqfeK5-hPdFh30oGRjzjCxwm6vctemQ8/edit#slide=id.g1165a219667_0_182)
for a visual overview of our evaluation framework. Additionally, the
[narrative
](https://docs.google.com/document/d/19yDyFCx1KeSPHlD9SLvLfG76FRGdfChL1hnCo_dV1zQ/edit) of
our evaluation plan provides more details.

To date (`r Sys.Date() |> format("%b %d, %Y")`),  Teaching Lab has
collected the following data during SY22-23:

-   `r format(nrow(session_survey), big.mark = ",")` complete responses
    to the End of Session Survey section of the survey that gathers
    participant feedback on facilitation from session to session;

-   `r format(nrow(course_survey), big.mark = ",")` complete responses
    to the End of Course Survey section of the survey that gathers
    participant feedback on each PL course;

-   `r format(nrow(ongoing_coaching), big.mark = ",")` complete
    responses to the Ongoing Coaching section of the survey that gathers
    participant feedback on each Coaching session;

-   `r format(nrow(end_coaching), big.mark = ",")` complete responses to
    the End of Coaching section of the survey that gathers participant
    feedback on each Coaching performance;

-   `r pre_know` complete responses to the first Knowledge or
    Self-Reported Practices Assessments and `r post_know` to the second
    Knowledge or Self-Reported Practices Assessments;

-   `r format(diagnostic_count, big.mark = ",")` complete responses to
    the Baseline Diagnostic Educator Survey that collects information on
    teachers' use of curricula, mindsets, self-reported practices, and
    school environment.

Below we have compiled the results in various sections: Participant
Background and Demographics Summary, Participant Perceptions,
Participant Knowledge, Teachers\' Mindsets & School Environment, School
Leaders\' Mindsets & Observational Practices, Instructional Practice,
and Student Outcomes.

# Section 1: Participant Background and Demographics Summary

This section provides a demographic and background summary on
participants.

## Gender and Racial Identity

::: {.fold .o}
<center>

```{r gender-identity, fig.dim = c(6.5, 4.5)}
if (sum(!is.na(educator_survey$gender)) >= 1) {
  gt_percent_n(
    df = educator_survey[!str_detect(educator_survey$gender, "NA"), ],
    column = "gender",
    custom_column_name = "Gender Identity", viz_type = sample(c("waffle", "pie", "treemap"),
      size = 1
    )
  )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r racial-identity, fig.dim = c(6.5, 4.5)}
race_cols <- c("race_1", "race_2", "race_3", "race_4", "race_5", "race_6", "race_7")
### Below code adds together the length of non na responses of all of the above columns to see if there is data ###
if (reduce(map(race_cols, ~ sum(!is.na(educator_survey[[.x]]))), `+`) >= 1) {
  educator_survey |>
    select(
      all_of(
        race_cols
      )
    ) |>
    pivot_longer(everything()) |>
    mutate(value = fct_lump(factor(value), 3)) |>
    rename(`Race Identity` = value) |>
    gt_percent_n(
      column = "Race Identity",
      custom_column_name = "Racial Identity",
      viz_type = sample(c("pie", "waffle", "treemap"), size = 1)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r racial-identity2, fig.dim = c(6.5, 4.5)}
if (sum(!is.na(educator_survey$ethnicity)) >= 1) {
  gt_percent_n(
    educator_survey[!str_detect(educator_survey$ethnicity, "NA"), ],
    column = "ethnicity",
    custom_column_name = "Ethnicity", viz_type = sample(c("waffle", "pie", "treemap"),
      size = 1
    )
  )
} else {
  no_data_plot
}
```

</center>
:::

## Years of Teaching Experience

::: {.fold .o}
<center>

```{r teach-experience}
if (sum(!is.na(educator_survey$teaching_experience)) >= 1) {
  n <- sum(!is.na(educator_survey$teaching_experience[!str_detect(educator_survey$teaching_experience, "NA")]))

  educator_survey |>
    # transmute(experience = as.numeric(teaching_experience)) |>
    # mutate(experience = experience - (experience %% 10)) |>
    drop_na(teaching_experience) |>
    dplyr::filter(!str_detect(teaching_experience, "NA")) |>
    dplyr::mutate(teaching_experience = na.omit(teaching_experience)) |>
    group_by(teaching_experience) |>
    count(sort = T) |>
    ungroup() |>
    mutate(
      percent = round(100 * n / sum(n), 1),
      # experience = factor(experience, levels = c("0", "10", "20", "30", "40", "50")),
      color = if_else(percent < 10, "black", "white"),
      hjust = if_else(color == "white", 1.5, -0.5)
    ) |>
    ggplot(aes(teaching_experience, percent)) +
    geom_col(aes(fill = percent)) +
    geom_text(aes(
      label = paste0(percent, "%"),
      color = color, hjust = hjust
    ),
    fontface = "bold"
    ) +
    coord_flip() +
    labs(title = glue::glue("Years of Teaching Experience (n = {n})"), x = "", y = "") +
    scale_color_manual(values = c("black", "white")) +
    scale_fill_continuous() +
    scale_y_continuous(
      labels = scales::percent_format(scale = 1),
      breaks = scales::pretty_breaks(n = 6)
    ) +
    scale_x_discrete(labels = c("Less than 1", "0-9", "10-19", "20-29", "30-39", "40-49", "50+")) +
    ggplot2::theme(
      axis.text = ggtext::element_markdown(size = 20),
      axis.title = ggtext::element_markdown(size = 24)
    ) +
    TeachingLab::theme_tl()
} else {
  no_data_plot
}
```

</center>
:::

## Content Area

::: {.fold .o}
<center>

```{r content-area, fig.dim = c(6.5, 4.5)}
if (sum(!is.na(educator_survey$content_area)) >= 1 & params$partner != "US_Digital Nest") {
  educator_survey |>
    select(content_area) |>
    drop_na() |>
    dplyr::filter(!str_detect(content_area, "NA")) |>
    gt_percent_n(
      column = "content_area",
      custom_column_name = "Content Area", viz_type = sample(c("waffle", "pie", "treemap"),
        size = 1
      )
    )
} else {
  no_data_plot
}
```

</center>
:::

## Grades

::: {.fold .o}
<center>

```{r grade}
grades <- c(map_chr(1:14, ~ paste0("grade_level_", .x)))
if (reduce(map(grades, ~ sum(!is.na(educator_survey[[.x]]))), `+`) >= 1) {
  n <- educator_survey |>
    select(all_of(grades)) |>
    janitor::remove_empty("rows") |>
    nrow()

  educator_survey |>
    select(all_of(grades)) |>
    mutate(across(everything(), ~ as.character(.x))) |>
    pivot_longer(everything()) |>
    tidyr::drop_na(value) |>
    group_by(value) |>
    count(sort = T) |>
    # mutate(name = as.character(readr::parse_number(name))) |>
    # suppressWarnings() |>
    # mutate(name = replace_na(name, "K")) |>
    ungroup() |>
    mutate(
      percent = round(100 * n / sum(n), 1),
      value = factor(value, levels = c(
        "K", "1", "2", "3", "4", "5",
        "6", "7", "8", "9", "10", "11",
        "12", "Other"
      ))
    ) |>
    ggplot(aes(value, percent)) +
    geom_col(aes(fill = percent)) +
    geom_text(aes(
      label = paste0(percent, "%"),
      color = ifelse(percent < 5, "white", "black"),
      vjust = ifelse(percent < 3, 1.3, -0.5)
    ),
    fontface = "bold"
    ) +
    labs(
      y = "", x = "Grade",
      title = glue::glue("Grades Taught (n = {n})"),
      subtitle = "<i>More than one could be selected.</i>"
    ) +
    scale_color_manual(values = c("black", "white")) +
    scale_fill_continuous() +
    scale_y_continuous(
      labels = scales::percent_format(scale = 1),
      breaks = scales::pretty_breaks(n = 6)
    ) +
    theme_tl() +
    theme(
      axis.text = element_markdown(size = 20),
      axis.title = element_markdown(size = 24),
      plot.subtitle = element_markdown()
    )
} else {
  no_data_plot
}
```

</center>
:::

## Prior Experience with Teaching Lab Professional Learning

::: {.fold .o}
<center>

```{r prior-experience, fig.dim = c(6.5, 4.5)}
if (sum(!str_detect(educator_survey$tl_pl_participation, "NA"), na.rm = T) >= 1) {
  gt_percent_n(
    df = educator_survey[!str_detect(educator_survey$tl_pl_participation, "NA"), ],
    column = "tl_pl_participation",
    custom_column_name = "Previous Experience with Teaching Lab", viz_type = sample(c("waffle", "pie", "treemap"),
      size = 1
    )
  )
} else {
  no_data_plot
}
```

</center>
:::

## Roles

::: {.fold .o}
<center>

```{r roles, fig.dim = c(6.5, 4.5)}
if (sum(!str_detect(educator_survey$role, "NA"), na.rm = T) >= 1) {
  gt_percent_n(
    df = educator_survey[!str_detect(educator_survey$role, "NA"), ],
    column = "role",
    custom_column_name = "Primary Role",
    viz_type = sample(c("waffle", "treemap"),
      size = 1
    )
  )
} else {
  no_data_plot
}
```

```{r roles2, fig.dim = c(6.5, 4.5)}
if (sum(!str_detect(educator_survey$lab_leader, "NA"), na.rm = T) >= 1) {
  gt_percent_n(
    df = educator_survey[!str_detect(educator_survey$lab_leader, "NA"), ],
    column = "lab_leader",
    custom_column_name = "Lab Leader",
    viz_type = sample(c("waffle", "pie", "treemap"),
      size = 1
    )
  )
} else {
  no_data_plot
}
```

</center>
:::

# Section 2: Participant Perceptions

This section summarizes participants\' feedback on Teaching Lab PL.

-   The End of Session survey is collected at the end of each PL course
    (except the last session) and is focused on feedback for the
    facilitators.

-   The End of Course survey is collected at the end of the last session
    of a PL course and focuses on feedback for the entire course.

-   The Ongoing Coaching Feedback Survey is periodically administered to
    teachers receiving coaching support to provide feedback on coaches.

-   The End of Coaching Feedback Survey is administered at the end of
    coaching support and provides feedback on the entire coaching
    experience.

Results are presented in the aggregate and then by each content area.

## Section 2a: End of Session Summary

### Aggregate

::: {.fold .o}
<center>

```{r session-plot-agree, fig.width = 12, fig.height = 7.5}
if (sum(!is.na(session_survey$fac_feedback_2_1)) >= 1) {
  ### Get second facilitator responses ###
  second_fac <- session_survey |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_2_1,
      `They facilitated the content clearly` = fac_feedback_2_2,
      `They effectively built a safe learning community` = fac_feedback_2_3,
      `They were fully prepared for the session` = fac_feedback_2_4,
      `They responded to the group’s needs` = fac_feedback_2_5
    )
  ### Get first facilitator combined with second agree per question for end of session survey ###
  plot_agree <- session_survey |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_1,
      `They facilitated the content clearly` = fac_feedback_2,
      `They effectively built a safe learning community` = fac_feedback_3,
      `They were fully prepared for the session` = fac_feedback_4,
      `They responded to the group’s needs` = fac_feedback_5
    ) |>
    bind_rows(second_fac) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 20)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  prepared_agree <- plot_agree |>
    agree_strongly_agree(question = "They were fully\nprepared for the\nsession")
  responded_agree <- plot_agree |>
    agree_strongly_agree(question = "They responded to\nthe group’s needs")
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = "They facilitated the\ncontent clearly")
  effectively_agree <- plot_agree |>
    agree_strongly_agree(question = "They effectively\nbuilt a safe\nlearning community")
  demonstrated_agree <- plot_agree |>
    agree_strongly_agree(question = "They demonstrated\ndeep knowledge of\nthe content they\nfacilitated")

  ### Calculate n size ###
  n_size_agree <- session_survey |>
    count(sort = T)

  ### Make ggplot of session survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course Facilitation (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 17),
      plot.title = element_text(size = 25),
      legend.text = element_text(size = 15)
    )
} else {
  prepared_agree <- "There is no data to show the % that"
  responded_agree <- "There is no data to show the % that"
  facilitated_agree <- "There is no data to show the % that"
  effectively_agree <- "There is no data to show the % that"
  demonstrated_agree <- "There is no data to show the % that"
  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r prepared_agree` strongly agree or agree that the facilitators
    were fully prepared for the session.
-   `r responded_agree` strongly agree or agree that the facilitators
    responded to the group's needs.
-   `r facilitated_agree` strongly agree or agree that the facilitators
    facilitated the content clearly.
-   `r effectively_agree` strongly agree or agree that the facilitators
    effectively built a safe learning community.
-   `r demonstrated_agree` strongly agree or agree that the facilitators
    demonstrated deep knowledge of the content they facilitated.

### Math

::: {.fold .o}
<center>

```{r session-math-plot-agree, fig.width = 12, fig.height = 7.5}
if (sum(!is.na(session_survey$fac_feedback_1[session_survey$content_area == "Math"])) >= 1) {
  ### Get second facilitator responses ###
  second_fac <- session_survey |>
    filter(content_area == "Math") |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_2_1,
      `They facilitated the content clearly` = fac_feedback_2_2,
      `They effectively built a safe learning community` = fac_feedback_2_3,
      `They were fully prepared for the session` = fac_feedback_2_4,
      `They responded to the group’s needs` = fac_feedback_2_5
    )
  ### Get first facilitator combined with second agree per question for end of session survey ###
  plot_agree <- session_survey |>
    filter(content_area == "Math") |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_1,
      `They facilitated the content clearly` = fac_feedback_2,
      `They effectively built a safe learning community` = fac_feedback_3,
      `They were fully prepared for the session` = fac_feedback_4,
      `They responded to the group’s needs` = fac_feedback_5
    ) |>
    bind_rows(second_fac) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 20)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  prepared_agree <- plot_agree |>
    agree_strongly_agree(question = "They were fully\nprepared for the\nsession")
  responded_agree <- plot_agree |>
    agree_strongly_agree(question = "They responded to\nthe group’s needs")
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = "They facilitated the\ncontent clearly")
  effectively_agree <- plot_agree |>
    agree_strongly_agree(question = "They effectively\nbuilt a safe\nlearning community")
  demonstrated_agree <- plot_agree |>
    agree_strongly_agree(question = "They demonstrated\ndeep knowledge of\nthe content they\nfacilitated")

  ### Calculate n size ###
  n_size_agree <- session_survey |>
    filter(content_area == "Math") |>
    count(sort = T)

  ### Make ggplot of session survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course Facilitation (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 17),
      plot.title = element_text(size = 25),
      legend.text = element_text(size = 15)
    )
} else {
  prepared_agree <- "There is no data to show the % that"
  responded_agree <- "There is no data to show the % that"
  facilitated_agree <- "There is no data to show the % that"
  effectively_agree <- "There is no data to show the % that"
  demonstrated_agree <- "There is no data to show the % that"
  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r prepared_agree` strongly agree or agree that the facilitators
    were fully prepared for the session.
-   `r responded_agree` strongly agree or agree that the facilitators
    responded to the group's needs.
-   `r facilitated_agree` strongly agree or agree that the facilitators
    facilitated the content clearly.
-   `r effectively_agree` strongly agree or agree that the facilitators
    effectively built a safe learning community.
-   `r demonstrated_agree` strongly agree or agree that the facilitators
    demonstrated deep knowledge of the content they facilitated.

### ELA

::: {.fold .o}
<center>

```{r session-ela-plot-agree, fig.width = 12, fig.height = 7.5}
if (sum(!is.na(session_survey$fac_feedback_1[session_survey$content_area == "ELA"])) >= 1) {
  ### Get second facilitator responses ###
  second_fac <- session_survey |>
    filter(content_area == "ELA") |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_2_1,
      `They facilitated the content clearly` = fac_feedback_2_2,
      `They effectively built a safe learning community` = fac_feedback_2_3,
      `They were fully prepared for the session` = fac_feedback_2_4,
      `They responded to the group’s needs` = fac_feedback_2_5
    )
  ### Get first facilitator combined with second agree per question for end of session survey ###
  plot_agree <- session_survey |>
    filter(content_area == "ELA") |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_1,
      `They facilitated the content clearly` = fac_feedback_2,
      `They effectively built a safe learning community` = fac_feedback_3,
      `They were fully prepared for the session` = fac_feedback_4,
      `They responded to the group’s needs` = fac_feedback_5
    ) |>
    bind_rows(second_fac) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 20)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  prepared_agree <- plot_agree |>
    agree_strongly_agree(question = "They were fully\nprepared for the\nsession")
  responded_agree <- plot_agree |>
    agree_strongly_agree(question = "They responded to\nthe group’s needs")
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = "They facilitated the\ncontent clearly")
  effectively_agree <- plot_agree |>
    agree_strongly_agree(question = "They effectively\nbuilt a safe\nlearning community")
  demonstrated_agree <- plot_agree |>
    agree_strongly_agree(question = "They demonstrated\ndeep knowledge of\nthe content they\nfacilitated")

  ### Calculate n size ###
  n_size_agree <- session_survey |>
    filter(content_area == "ELA") |>
    count(sort = T)

  ### Make ggplot of session survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course Facilitation (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 17),
      plot.title = element_text(size = 25),
      legend.text = element_text(size = 15)
    )
} else {
  prepared_agree <- "There is no data to show the % that"
  responded_agree <- "There is no data to show the % that"
  facilitated_agree <- "There is no data to show the % that"
  effectively_agree <- "There is no data to show the % that"
  demonstrated_agree <- "There is no data to show the % that"
  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r prepared_agree` strongly agree or agree that the facilitators
    were fully prepared for the session.
-   `r responded_agree` strongly agree or agree that the facilitators
    responded to the group's needs.
-   `r facilitated_agree` strongly agree or agree that the facilitators
    facilitated the content clearly.
-   `r effectively_agree` strongly agree or agree that the facilitators
    effectively built a safe learning community.
-   `r demonstrated_agree` strongly agree or agree that the facilitators
    demonstrated deep knowledge of the content they facilitated.

### Other

::: {.fold .o}
<center>

```{r session-other-plot-agree, fig.width = 12, fig.height = 7.5}
if (sum(!is.na(session_survey$fac_feedback_1[session_survey$content_area %!in% c("ELA", "Math")])) >= 1) {
  ### Get second facilitator responses ###
  second_fac <- session_survey |>
    filter(content_area %!in% c("ELA", "Math")) |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_2_1,
      `They facilitated the content clearly` = fac_feedback_2_2,
      `They effectively built a safe learning community` = fac_feedback_2_3,
      `They were fully prepared for the session` = fac_feedback_2_4,
      `They responded to the group’s needs` = fac_feedback_2_5
    )
  ### Get first facilitator combined with second agree per question for end of session survey ###
  plot_agree <- session_survey |>
    filter(content_area %!in% c("ELA", "Math")) |>
    select(
      `They demonstrated deep knowledge of the content they facilitated` = fac_feedback_1,
      `They facilitated the content clearly` = fac_feedback_2,
      `They effectively built a safe learning community` = fac_feedback_3,
      `They were fully prepared for the session` = fac_feedback_4,
      `They responded to the group’s needs` = fac_feedback_5
    ) |>
    bind_rows(second_fac) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 20)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  prepared_agree <- plot_agree |>
    agree_strongly_agree(question = "They were fully\nprepared for the\nsession")
  responded_agree <- plot_agree |>
    agree_strongly_agree(question = "They responded to\nthe group’s needs")
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = "They facilitated the\ncontent clearly")
  effectively_agree <- plot_agree |>
    agree_strongly_agree(question = "They effectively\nbuilt a safe\nlearning community")
  demonstrated_agree <- plot_agree |>
    agree_strongly_agree(question = "They demonstrated\ndeep knowledge of\nthe content they\nfacilitated")

  ### Calculate n size ###
  n_size_agree <- session_survey |>
    filter(content_area %!in% c("ELA", "Math")) |>
    count(sort = T)

  ### Make ggplot of session survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course Facilitation (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 17),
      plot.title = element_text(size = 25),
      legend.text = element_text(size = 15)
    )
} else {
  prepared_agree <- "There is no data to show the % that"
  responded_agree <- "There is no data to show the % that"
  facilitated_agree <- "There is no data to show the % that"
  effectively_agree <- "There is no data to show the % that"
  demonstrated_agree <- "There is no data to show the % that"
  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r prepared_agree` strongly agree or agree that the facilitators
    were fully prepared for the session.
-   `r responded_agree` strongly agree or agree that the facilitators
    responded to the group's needs.
-   `r facilitated_agree` strongly agree or agree that the facilitators
    facilitated the content clearly.
-   `r effectively_agree` strongly agree or agree that the facilitators
    effectively built a safe learning community.
-   `r demonstrated_agree` strongly agree or agree that the facilitators
    demonstrated deep knowledge of the content they facilitated.

Finally, here are some highlights from the qualitative feedback.

### Responses to "What went well in today's session?"

::: {.fold .o}
<center>

```{r facilitation-feedback-2, fig.dim = c(14, 5), eval = T}
quote2 <- session_survey |>
  select(`What went well in today’s session?` = went_well_today) |>
  drop_na() |>
  filter(`What went well in today’s session?` %!in% na_df) |>
  filter(str_length(`What went well in today’s session?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What went well in today’s session?`)
if (nrow(quote2) >= 1) {
  quote_viz(
    data = quote2,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab1_2.png"))

  knitr::include_graphics(here::here("images/report_images/tab1_2.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "What could have been better about today's session?"

::: {.fold .o}
<center>

```{r facilitation-feedback-1, fig.dim = c(14, 5), eval = T}
quote1 <- session_survey |>
  select(`What could have been better about today’s session?` = been_better_today) |>
  drop_na() |>
  filter(`What could have been better about today’s session?` %!in% na_df) |>
  filter(str_length(`What could have been better about today’s session?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What could have been better about today’s session?`)

if (nrow(quote1) >= 1) {
  table1 <- TeachingLab::quote_viz(
    data = quote1,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  )
  # as_raw_html() |>
  gt::gtsave(table1, filename = here::here("images/report_images/tab1_1.png"))

  knitr::include_graphics(here::here("images/report_images/tab1_1.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "What is one thing from today's learning that you plan to take back to your classroom?"

::: {.fold .o}
<center>

```{r facilitation-feedback-3, fig.dim = c(14, 5), eval = T}
quote3 <- session_survey |>
  select(`What is one thing from today's learning that you plan to take back to your classroom?` = take_back_class) |>
  drop_na() |>
  filter(`What is one thing from today's learning that you plan to take back to your classroom?` %!in% na_df) |>
  filter(str_length(`What is one thing from today's learning that you plan to take back to your classroom?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What is one thing from today's learning that you plan to take back to your classroom?`)

if (nrow(quote3) >= 1) {
  quote_viz(
    data = quote3,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab1_3.png"))

  knitr::include_graphics(here::here("images/report_images/tab1_3.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "What additional feedback do you have about their facilitation skills, if any?"

::: {.fold .o}
<center>

```{r additional-feedback, fig.dim = c(14, 5), eval = T}
### Get Second Facilitator Feedback as well ###
second_fac <- session_survey |>
  select(`What additional feedback do you have about their facilitation skills, if any?` = fac_add_2)

quote4 <- session_survey |>
  select(`What additional feedback do you have about their facilitation skills, if any?` = fac_add1) |>
  bind_rows(second_fac) |>
  drop_na() |>
  filter(`What additional feedback do you have about their facilitation skills, if any?` %!in% na_df) |>
  filter(str_length(`What additional feedback do you have about their facilitation skills, if any?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What additional feedback do you have about their facilitation skills, if any?`)
if (nrow(quote4) >= 1) {
  quote_viz(
    data = quote4,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab1_4.png"))

  knitr::include_graphics(here::here("images/report_images/tab1_4.png"))
} else {
  no_data_plot
}
```

</center>
:::

## Section 2b: End of Course Summary

### Aggregate

::: {.fold .o}
<center>

```{r course-plot-agree, fig.width = 12, fig.height = 9}
if (sum(!is.na(course_survey$course_feedback_1)) >= 1) {
  ### Get first facilitator combined with second agree per question for end of course survey ###
  plot_agree <- course_survey |>
    select(
      `I looked forward to attending this PL` = course_feedback_1,
      `I was fully present/\"minds-on\" during these PL sessions` = course_feedback_2,
      `The activities were well-designed to help me meet the learning targets` = course_feedback_3,
      `I am satisfied with how the course was facilitated` = course_feedback_4,
      `This PL was a good use of my time` = course_feedback_5,
      `I talk to other teachers about the things I learned in this PL` = course_feedback_6,
      `I felt a sense of community with the other participants in this course` = course_feedback_7,
      `This course was relevant to my instructional practices` = course_feedback_8,
      `The strategies I’ve learned in this course will improve my instruction` = course_feedback_9,
      `The strategies I’ve learned in this course will improve my coaching or supervision of teachers` = course_feedback_10,
      `The strategies I’ve learned in the course are easy to implement` = course_feedback_11,
      `I have applied or will apply what I have learned in this course to my practice` = course_feedback_12,
      `This course has supported me in being responsive to students' backgrounds, cultures, and points of view` = course_feedback_13,
      `I am satisfied with the overall quality of this course` = course_feedback_14 # ,
      # `I think the professional learning will have a significant positive impact on my math instruction next year` = course_feedback_15
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 40)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> magrittr::extract(1))
  quality_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "quality")) |> magrittr::extract(1))
  community_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "community")) |> magrittr::extract(1))
  applied_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "applied")) |> magrittr::extract(1))
  looked_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "looked")) |> magrittr::extract(1))
  talk_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "talk")) |> magrittr::extract(1))
  present_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "minds")) |> magrittr::extract(1))
  activities_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "designed")) |> magrittr::extract(1))
  improve_supervision_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "supervision")) |> magrittr::extract(1))
  improve_instruction_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> keep(~ !str_detect(.x, "supervison")) |> magrittr::extract(1))
  supported_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "responsive")) |> magrittr::extract(1))
  relevant_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "relevant")) |> magrittr::extract(1))
  time_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "time")) |> magrittr::extract(1))

  ### Calculate n size ###
  n_size_agree <- course_survey |>
    count(sort = T)

  ### Make ggplot of course survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 13, lineheight = 0.8),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -80),
      legend.text = element_text(size = 13)
    )
} else {
  facilitated_agree <- "There is no data to show the % that"
  quality_agree <- "There is no data to show the % that"
  community_agree <- "There is no data to show the % that"
  applied_agree <- "There is no data to show the % that"
  looked_agree <- "There is no data to show the % that"
  talk_agree <- "There is no data to show the % that"
  present_agree <- "There is no data to show the % that"
  activities_agree <- "There is no data to show the % that"
  improve_supervision_agree <- "There is no data to show the % that"
  improve_instruction_agree <- "There is no data to show the % that"
  supported_agree <- "There is no data to show the % that"
  relevant_agree <- "There is no data to show the % that"
  time_agree <- "There is no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r time_agree` strongly agree or agree that the PL was a good use of
    their time.
-   `r relevant_agree` strongly agree or agree that the course was
    relevant to their instructional practices.
-   `r supported_agree` strongly agree or agree that the course has
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r improve_instruction_agree` strongly agree or agree that what
    they've learned in this course will improve my instruction.
-   `r improve_supervision_agree` strongly agree or agree that what
    they've learned in this course will improve my supervision of
    teachers.
-   `r activities_agree` strongly agree or agree that the activities
    were well-designed to help them meet the learning targets.
-   `r present_agree` strongly agree or agree that they were fully
    present "minds-on" during these PL sessions.
-   `r talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned in this PL.
-   `r looked_agree` strongly agree or agree that they looked forward to
    attending this PL.
-   `r applied_agree` strongly agree or agree that they will apply what
    they have learned in the course to their practice.
-   `r community_agree` strongly agree or agree that they felt a sense
    of community with the other participants in the course.
-   `r quality_agree` strongly agree or agree that they were satisfied
    with the overall quality of the course.
-   `r facilitated_agree` strongly agree or agree that they were
    satisfied with how the course was facilitated.

### Math

::: {.fold .o}
<center>

```{r course-math-plot-agree, fig.width = 12, fig.height = 9}
if (sum(!is.na(course_survey$course_feedback_1[course_survey$content_area == "Math"])) >= 1) {
  ### End of course survey relabel and % calculation ###
  plot_agree <- course_survey |>
    filter(content_area == "Math") |>
    select(
      `I looked forward to attending this PL` = course_feedback_1,
      `I was fully present/\"minds-on\" during these PL sessions` = course_feedback_2,
      `The activities were well-designed to help me meet the learning targets` = course_feedback_3,
      `I am satisfied with how the course was facilitated` = course_feedback_4,
      `This PL was a good use of my time` = course_feedback_5,
      `I talk to other teachers about the things I learned in this PL` = course_feedback_6,
      `I felt a sense of community with the other participants in this course` = course_feedback_7,
      `This course was relevant to my instructional practices` = course_feedback_8,
      `The strategies I’ve learned in this course will improve my instruction` = course_feedback_9,
      `The strategies I’ve learned in this course will improve my coaching or supervision of teachers` = course_feedback_10,
      `The strategies I’ve learned in the course are easy to implement` = course_feedback_11,
      `I have applied or will apply what I have learned in this course to my practice` = course_feedback_12,
      `This course has supported me in being responsive to students' backgrounds, cultures, and points of view` = course_feedback_13,
      `I am satisfied with the overall quality of this course` = course_feedback_14 # ,
      # `I think the professional learning will have a significant positive impact on my math instruction next year` = course_feedback_15
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 40)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> magrittr::extract(1))
  quality_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "quality")) |> magrittr::extract(1))
  community_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "community")) |> magrittr::extract(1))
  applied_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "applied")) |> magrittr::extract(1))
  looked_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "looked")) |> magrittr::extract(1))
  talk_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "talk")) |> magrittr::extract(1))
  present_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "minds")) |> magrittr::extract(1))
  activities_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "designed")) |> magrittr::extract(1))
  improve_supervision_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "supervision")) |> magrittr::extract(1))
  improve_instruction_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> keep(~ !str_detect(.x, "supervison")) |> magrittr::extract(1))
  supported_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "responsive")) |> magrittr::extract(1))
  relevant_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "relevant")) |> magrittr::extract(1))
  time_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "time")) |> magrittr::extract(1))

  ### Calculate n size ###
  n_size_agree <- course_survey |>
    filter(content_area == "Math") |>
    count(sort = T)

  ### Make ggplot of course survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 13, lineheight = 0.8),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -80),
      legend.text = element_text(size = 13)
    )
} else {
  facilitated_agree <- "There is no data to show the % that"
  quality_agree <- "There is no data to show the % that"
  community_agree <- "There is no data to show the % that"
  applied_agree <- "There is no data to show the % that"
  looked_agree <- "There is no data to show the % that"
  talk_agree <- "There is no data to show the % that"
  present_agree <- "There is no data to show the % that"
  activities_agree <- "There is no data to show the % that"
  improve_supervision_agree <- "There is no data to show the % that"
  improve_instruction_agree <- "There is no data to show the % that"
  supported_agree <- "There is no data to show the % that"
  relevant_agree <- "There is no data to show the % that"
  time_agree <- "There is no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r time_agree` strongly agree or agree that the PL was a good use of
    their time.
-   `r relevant_agree` strongly agree or agree that the course was
    relevant to their instructional practices.
-   `r supported_agree` strongly agree or agree that the course has
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r improve_instruction_agree` strongly agree or agree that what
    they've learned in this course will improve my instruction.
-   `r improve_supervision_agree` strongly agree or agree that what
    they've learned in this course will improve my supervision of
    teachers.
-   `r activities_agree` strongly agree or agree that the activities
    were well-designed to help them meet the learning targets.
-   `r present_agree` strongly agree or agree that they were fully
    present "minds-on" during these PL sessions.
-   `r talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned in this PL.
-   `r looked_agree` strongly agree or agree that they looked forward to
    attending this PL.
-   `r applied_agree` strongly agree or agree that they will apply what
    they have learned in the course to their practice.
-   `r community_agree` strongly agree or agree that they felt a sense
    of community with the other participants in the course.
-   `r quality_agree` strongly agree or agree that they were satisfied
    with the overall quality of the course.
-   `r facilitated_agree` strongly agree or agree that they were
    satisfied with how the course was facilitated.

### ELA

::: {.fold .o}
<center>

```{r course-ela-plot-agree, fig.width = 12, fig.height = 9}
if (sum(!is.na(course_survey$course_feedback_1[course_survey$content_area == "ELA"])) >= 1) {
  ### End of course survey relabel and % calculation ###
  plot_agree <- course_survey |>
    filter(content_area == "ELA") |>
    select(
      `I looked forward to attending this PL` = course_feedback_1,
      `I was fully present/\"minds-on\" during these PL sessions` = course_feedback_2,
      `The activities were well-designed to help me meet the learning targets` = course_feedback_3,
      `I am satisfied with how the course was facilitated` = course_feedback_4,
      `This PL was a good use of my time` = course_feedback_5,
      `I talk to other teachers about the things I learned in this PL` = course_feedback_6,
      `I felt a sense of community with the other participants in this course` = course_feedback_7,
      `This course was relevant to my instructional practices` = course_feedback_8,
      `The strategies I’ve learned in this course will improve my instruction` = course_feedback_9,
      `The strategies I’ve learned in this course will improve my coaching or supervision of teachers` = course_feedback_10,
      `The strategies I’ve learned in the course are easy to implement` = course_feedback_11,
      `I have applied or will apply what I have learned in this course to my practice` = course_feedback_12,
      `This course has supported me in being responsive to students' backgrounds, cultures, and points of view` = course_feedback_13,
      `I am satisfied with the overall quality of this course` = course_feedback_14 # ,
      # `I think the professional learning will have a significant positive impact on my math instruction next year` = course_feedback_15
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 40)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> magrittr::extract(1))
  quality_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "quality")) |> magrittr::extract(1))
  community_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "community")) |> magrittr::extract(1))
  applied_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "applied")) |> magrittr::extract(1))
  looked_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "looked")) |> magrittr::extract(1))
  talk_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "talk")) |> magrittr::extract(1))
  present_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "minds")) |> magrittr::extract(1))
  activities_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "designed")) |> magrittr::extract(1))
  improve_supervision_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "supervision")) |> magrittr::extract(1))
  improve_instruction_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> keep(~ !str_detect(.x, "supervison")) |> magrittr::extract(1))
  supported_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "responsive")) |> magrittr::extract(1))
  relevant_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "relevant")) |> magrittr::extract(1))
  time_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "time")) |> magrittr::extract(1))

  ### Calculate n size ###
  n_size_agree <- course_survey |>
    filter(content_area == "ELA") |>
    count(sort = T)

  ### Make ggplot of course survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 13, lineheight = 0.8),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -80),
      legend.text = element_text(size = 13)
    )
} else {
  facilitated_agree <- "There is no data to show the % that"
  quality_agree <- "There is no data to show the % that"
  community_agree <- "There is no data to show the % that"
  applied_agree <- "There is no data to show the % that"
  looked_agree <- "There is no data to show the % that"
  talk_agree <- "There is no data to show the % that"
  present_agree <- "There is no data to show the % that"
  activities_agree <- "There is no data to show the % that"
  improve_supervision_agree <- "There is no data to show the % that"
  improve_instruction_agree <- "There is no data to show the % that"
  supported_agree <- "There is no data to show the % that"
  relevant_agree <- "There is no data to show the % that"
  time_agree <- "There is no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r time_agree` strongly agree or agree that the PL was a good use of
    their time.
-   `r relevant_agree` strongly agree or agree that the course was
    relevant to their instructional practices.
-   `r supported_agree` strongly agree or agree that the course has
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r improve_instruction_agree` strongly agree or agree that what
    they've learned in this course will improve my instruction.
-   `r improve_supervision_agree` strongly agree or agree that what
    they've learned in this course will improve my supervision of
    teachers.
-   `r activities_agree` strongly agree or agree that the activities
    were well-designed to help them meet the learning targets.
-   `r present_agree` strongly agree or agree that they were fully
    present "minds-on" during these PL sessions.
-   `r talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned in this PL.
-   `r looked_agree` strongly agree or agree that they looked forward to
    attending this PL.
-   `r applied_agree` strongly agree or agree that they will apply what
    they have learned in the course to their practice.
-   `r community_agree` strongly agree or agree that they felt a sense
    of community with the other participants in the course.
-   `r quality_agree` strongly agree or agree that they were satisfied
    with the overall quality of the course.
-   `r facilitated_agree` strongly agree or agree that they were
    satisfied with how the course was facilitated.

### Other

::: {.fold .o}
<center>

```{r course-other-plot-agree, fig.width = 12, fig.height = 9}
if (sum(!is.na(course_survey$course_feedback_1[course_survey$content_area %!in% c("ELA", "Math")])) >= 1) {
  ### End of course survey relabel and % calculation ###
  plot_agree <- course_survey |>
    filter(content_area %!in% c("ELA", "Math")) |>
    select(
      `I looked forward to attending this PL` = course_feedback_1,
      `I was fully present/\"minds-on\" during these PL sessions` = course_feedback_2,
      `The activities were well-designed to help me meet the learning targets` = course_feedback_3,
      `I am satisfied with how the course was facilitated` = course_feedback_4,
      `This PL was a good use of my time` = course_feedback_5,
      `I talk to other teachers about the things I learned in this PL` = course_feedback_6,
      `I felt a sense of community with the other participants in this course` = course_feedback_7,
      `This course was relevant to my instructional practices` = course_feedback_8,
      `The strategies I’ve learned in this course will improve my instruction` = course_feedback_9,
      `The strategies I’ve learned in this course will improve my coaching or supervision of teachers` = course_feedback_10,
      `The strategies I’ve learned in the course are easy to implement` = course_feedback_11,
      `I have applied or will apply what I have learned in this course to my practice` = course_feedback_12,
      `This course has supported me in being responsive to students' backgrounds, cultures, and points of view` = course_feedback_13,
      `I am satisfied with the overall quality of this course` = course_feedback_14 # ,
      # `I think the professional learning will have a significant positive impact on my math instruction next year` = course_feedback_15
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na() |>
    group_by(Question, Response) |>
    count() |>
    ungroup() |>
    group_by(Question) |>
    mutate(Question = str_wrap(Question, width = 40)) |>
    summarise(
      n = n,
      Response = Response,
      Percent = n / sum(n) * 100
    )

  ### Calculate agree/strongly agree per each question ###
  facilitated_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> magrittr::extract(1))
  quality_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "quality")) |> magrittr::extract(1))
  community_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "community")) |> magrittr::extract(1))
  applied_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "applied")) |> magrittr::extract(1))
  looked_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "looked")) |> magrittr::extract(1))
  talk_agree <- plot_agree |>
    agree_strongly_agree(question = "I talk to other teachers about the\nthings I learned in this PL")
  present_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "minds")) |> magrittr::extract(1))
  activities_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "designed")) |> magrittr::extract(1))
  improve_supervision_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "supervision")) |> magrittr::extract(1))
  improve_instruction_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "facilitated")) |> keep(~ !str_detect(.x, "supervison")) |> magrittr::extract(1))
  supported_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "responsive")) |> magrittr::extract(1))
  relevant_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "relevant")) |> magrittr::extract(1))
  time_agree <- plot_agree |>
    agree_strongly_agree(question = plot_agree$Question |> keep(~ str_detect(.x, "time")) |> magrittr::extract(1))

  ### Calculate n size ###
  n_size_agree <- course_survey |>
    filter(content_area %!in% c("ELA", "Math")) |>
    count(sort = T)

  ### Make ggplot of course survey agree percent ###
  plot_agree |>
    group_by(Question, Response) |>
    summarise(Percent = weighted.mean(Percent, n)) |>
    mutate(Question = factor(Question)) |>
    ggplot(aes(x = Question, y = Percent, fill = factor(Response))) +
    geom_col(color = NA, width = 0.95, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    size = 6.5,
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold"
    ) +
    scale_fill_manual(values = c(
      "(1) Strongly disagree" = "#040404", "(2) Disagree" = "#032E3F",
      "(3) Neither agree nor disagree" = "#02587A", "(4) Agree" = "#0182B4", "(5) Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "(1) Strongly disagree" = "white", "(2) Disagree" = "white",
      "(3) Neither agree nor disagree" = "black", "(4) Agree" = "black", "(5) Strongly agree" = "black"
    )) +
    labs(
      fill = "", title = glue::glue("Participant Perceptions of Course (n = {format(sum(n_size_agree$n), big.mark = ',')})"),
      x = "", y = ""
    ) +
    coord_flip() +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(labels = scales::percent_format(scale = 1)) +
    theme_final_report() +
    theme(
      axis.text.y = element_text(size = 13, lineheight = 0.8),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -80),
      legend.text = element_text(size = 13)
    )
} else {
  quality_agree <- "There is no data to show the % that"
  facilitated_agree <- "There is no data to show the % that"
  community_agree <- "There is no data to show the % that"
  applied_agree <- "There is no data to show the % that"
  looked_agree <- "There is no data to show the % that"
  talk_agree <- "There is no data to show the % that"
  present_agree <- "There is no data to show the % that"
  activities_agree <- "There is no data to show the % that"
  improve_supervision_agree <- "There is no data to show the % that"
  improve_instruction_agree <- "There is no data to show the % that"
  supported_agree <- "There is no data to show the % that"
  relevant_agree <- "There is no data to show the % that"
  time_agree <- "There is no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r time_agree` strongly agree or agree that the PL was a good use of
    their time.
-   `r relevant_agree` strongly agree or agree that the course was
    relevant to their instructional practices.
-   `r supported_agree` strongly agree or agree that the course has
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r improve_instruction_agree` strongly agree or agree that what
    they've learned in this course will improve my instruction.
-   `r improve_supervision_agree` strongly agree or agree that what
    they've learned in this course will improve my supervision of
    teachers.
-   `r activities_agree` strongly agree or agree that the activities
    were well-designed to help them meet the learning targets.
-   `r present_agree` strongly agree or agree that they were fully
    present "minds-on" during these PL sessions.
-   `r talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned in this PL.
-   `r looked_agree` strongly agree or agree that they looked forward to
    attending this PL.
-   `r applied_agree` strongly agree or agree that they will apply what
    they have learned in the course to their practice.
-   `r community_agree` strongly agree or agree that they felt a sense
    of community with the other participants in the course.
-   `r quality_agree` strongly agree or agree that they were satisfied
    with the overall quality of the course.
-   `r facilitated_agree` strongly agree or agree that they were
    satisfied with how the course was facilitated.

Several samplings of the textual feedback from the course survey are
presented below.

### Responses to "Overall, what went well in this course?"

::: {.fold .o}
<center>

```{r course-quote-1, fig.dim = c(14, 5), eval = T}
quote1 <- course_survey |>
  select(`Overall, what went well in this course?` = overall_went_well) |>
  drop_na() |>
  filter(`Overall, what went well in this course?` %!in% na_df) |>
  filter(str_length(`Overall, what went well in this course?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Overall, what went well in this course?`)

if (nrow(quote1) >= 1) {
  quote_viz(
    data = quote1,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab2_1.png"))

  knitr::include_graphics(here::here("images/report_images/tab2_1.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "Overall, what could have been better in this course?"

::: {.fold .o}
<center>

```{r course-quote-2, fig.dim = c(14, 5), eval = T}
quote2 <- course_survey |>
  select(`Overall, what could have been better in this course?` = been_better_course) |>
  drop_na() |>
  filter(`Overall, what could have been better in this course?` %!in% na_df) |>
  filter(str_length(`Overall, what could have been better in this course?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Overall, what could have been better in this course?`)

if (nrow(quote2) >= 1) {
  quote_viz(
    data = quote2,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab2_2.png"))

  knitr::include_graphics(here::here("images/report_images/tab2_2.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "What is the learning from this course that you are most excited to try out?"

::: {.fold .o}
<center>

```{r course-quote-3, fig.dim = c(6.5, 4.5), eval = T}
quote3 <- course_survey |>
  select(`What is the learning from this course that you are most excited to try out?` = learning_excited_try) |>
  drop_na() |>
  filter(`What is the learning from this course that you are most excited to try out?` %!in% na_df) |>
  filter(str_length(`What is the learning from this course that you are most excited to try out?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What is the learning from this course that you are most excited to try out?`)

if (nrow(quote3) >= 1) {
  quote_viz(
    data = quote3,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab2_3.png"))

  knitr::include_graphics(here::here("images/report_images/tab2_3.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "Which activities best supported your learning in this course?"

::: {.fold .o}
<center>

```{r course-quote-4, fig.dim = c(14, 5), eval = T}
quote4 <- course_survey |>
  select(`Which activities best supported your learning in this course?` = best_activities) |>
  drop_na() |>
  filter(`Which activities best supported your learning in this course?` %!in% na_df) |>
  filter(str_length(`Which activities best supported your learning in this course?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Which activities best supported your learning in this course?`)

if (nrow(quote4) >= 1) {
  quote_viz(
    data = quote4,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab2_4.png"))

  knitr::include_graphics(here::here("images/report_images/tab2_4.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "Feel free to leave us any additional comments, concerns, or questions."

::: {.fold .o}
<center>

```{r course-quote-5, fig.dim = c(14, 5), eval = T}
quote5 <- course_survey |>
  select(`Feel free to leave us any additional comments, concerns, or questions.` = coach_additonal_feed) |>
  drop_na() |>
  filter(`Feel free to leave us any additional comments, concerns, or questions.` %!in% na_df) |>
  filter(str_length(`Feel free to leave us any additional comments, concerns, or questions.`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Feel free to leave us any additional comments, concerns, or questions.`)

if (nrow(quote5) >= 1) {
  quote_viz(
    data = quote5,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab2_5.png"))

  knitr::include_graphics(here::here("images/report_images/tab2_5.png"))
} else {
  no_data_plot
}
```

</center>
:::

## Section 2c: Ongoing Coaching Feedback

### Aggregate

::: {.fold .o}
<center>

```{r coaching-feedback, fig.width = 12, fig.height = 6}
if (nrow(ongoing_coaching) >= 1) {
  coaching_plot_agree <- ongoing_coaching |>
    select(
      `They demonstrated deep knowledge of the content they coach` = coach_ongoing_feed_1,
      `Their coaching is clear` = coach_ongoing_feed_2,
      `They seem fully prepared for the coaching sessions` = coach_ongoing_feed_3,
      `They effectively build a safe learning environment` = coach_ongoing_feed_4,
      `They make necessary adjustments based on my needs` = coach_ongoing_feed_5
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 30)
    )

  n_size_agree <- ongoing_coaching |>
    count(sort = T)

  ### Percent Agree Strongly Agrees Aggregate ###
  coach_prepared_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They seem fully prepared for<br>the coaching sessions")
  coach_adjustments_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They make necessary<br>adjustments based on my needs")
  coach_effectively_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They effectively build a safe<br>learning environment")
  coach_knowledge_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They demonstrated deep<br>knowledge of the content they<br>coach")
  coach_clear_coaching_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "Their coaching is clear")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Ongoing Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 17,
        margin = margin(r = -55)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -170),
      legend.text = element_text(size = 15)
    )
} else {
  coach_prepared_agree <- "There was no data to show the % that"
  coach_adjustments_agree <- "There was no data to show the % that"
  coach_effectively_agree <- "There was no data to show the % that"
  coach_knowledge_agree <- "There was no data to show the % that"
  coach_clear_coaching_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_effectively_agree` strongly agree or agree that the coaches
    effectively built a safe learning environment.
-   `r coach_clear_coaching_agree` strongly agree or agree that the
    coaching was clear.
-   `r coach_prepared_agree` strongly agree or agree that the coach
    seemed fully prepared for the coaching sessions.
-   `r coach_adjustments_agree` strongly agree or agree that the coaches
    made necessary adjustments based on their needs.
-   `r coach_knowledge_agree` strongly agree or agree that the coaches
    demonstrated deep knowledge of the content they coach.

### Math

::: {.fold .o}
<center>

```{r coaching-math-feedback, fig.width = 12, fig.height = 6}
if (nrow(ongoing_coaching[ongoing_coaching$content_area == "Math", ]) >= 1) {
  coaching_plot_agree <- ongoing_coaching |>
    filter(content_area == "Math") |>
    select(
      `They demonstrated deep knowledge of the content they coach` = coach_ongoing_feed_1,
      `Their coaching is clear` = coach_ongoing_feed_2,
      `They seem fully prepared for the coaching sessions` = coach_ongoing_feed_3,
      `They effectively build a safe learning environment` = coach_ongoing_feed_4,
      `They make necessary adjustments based on my needs` = coach_ongoing_feed_5
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 30)
    )

  n_size_agree <- ongoing_coaching |>
    filter(content_area == "Math") |>
    count(sort = T)

  ### Percent Agree Strongly Agrees Math ###
  coach_prepared_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They seem fully prepared for<br>the coaching sessions")
  coach_adjustments_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They make necessary<br>adjustments based on my needs")
  coach_effectively_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They effectively build a safe<br>learning environment")
  coach_knowledge_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They demonstrated deep<br>knowledge of the content they<br>coach")
  coach_clear_coaching_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "Their coaching is clear")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Ongoing Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 17,
        margin = margin(r = -55)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -170),
      legend.text = element_text(size = 15)
    )
} else {
  coach_prepared_agree <- "There was no data to show the % that"
  coach_adjustments_agree <- "There was no data to show the % that"
  coach_effectively_agree <- "There was no data to show the % that"
  coach_knowledge_agree <- "There was no data to show the % that"
  coach_clear_coaching_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_effectively_agree` strongly agree or agree that the coaches
    effectively built a safe learning environment.
-   `r coach_clear_coaching_agree` strongly agree or agree that the
    coaching was clear.
-   `r coach_prepared_agree` strongly agree or agree that the coach
    seemed fully prepared for the coaching sessions.
-   `r coach_adjustments_agree` strongly agree or agree that the coaches
    made necessary adjustments based on their needs.
-   `r coach_knowledge_agree` strongly agree or agree that the coaches
    demonstrated deep knowledge of the content they coach.

### ELA

::: {.fold .o}
<center>

```{r coaching-ela-feedback, fig.width = 12, fig.height = 6}
if (nrow(ongoing_coaching[ongoing_coaching$content_area == "ELA", ]) >= 1) {
  coaching_plot_agree <- ongoing_coaching |>
    filter(content_area == "ELA") |>
    select(
      `They demonstrated deep knowledge of the content they coach` = coach_ongoing_feed_1,
      `Their coaching is clear` = coach_ongoing_feed_2,
      `They seem fully prepared for the coaching sessions` = coach_ongoing_feed_3,
      `They effectively build a safe learning environment` = coach_ongoing_feed_4,
      `They make necessary adjustments based on my needs` = coach_ongoing_feed_5
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 30)
    )

  n_size_agree <- ongoing_coaching |>
    filter(content_area == "ELA") |>
    count(sort = T)

  ### Percent Agree Strongly Agrees ELA ###
  coach_prepared_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They seem fully prepared for<br>the coaching sessions")
  coach_adjustments_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They make necessary<br>adjustments based on my needs")
  coach_effectively_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They effectively build a safe<br>learning environment")
  coach_knowledge_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They demonstrated deep<br>knowledge of the content they<br>coach")
  coach_clear_coaching_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "Their coaching is clear")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Ongoing Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 17,
        margin = margin(r = -55)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -170),
      legend.text = element_text(size = 15)
    )
} else {
  coach_prepared_agree <- "There was no data to show the % that"
  coach_adjustments_agree <- "There was no data to show the % that"
  coach_effectively_agree <- "There was no data to show the % that"
  coach_knowledge_agree <- "There was no data to show the % that"
  coach_clear_coaching_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_effectively_agree` strongly agree or agree that the coaches
    effectively built a safe learning environment.
-   `r coach_clear_coaching_agree` strongly agree or agree that the
    coaching was clear.
-   `r coach_prepared_agree` strongly agree or agree that the coach
    seemed fully prepared for the coaching sessions.
-   `r coach_adjustments_agree` strongly agree or agree that the coaches
    made necessary adjustments based on their needs.
-   `r coach_knowledge_agree` strongly agree or agree that the coaches
    demonstrated deep knowledge of the content they coach.

### Other

::: {.fold .o}
<center>

```{r coaching-other-feedback, fig.width = 12, fig.height = 6}
if (nrow(ongoing_coaching[ongoing_coaching$content_area == "Other", ]) >= 1) {
  coaching_plot_agree <- ongoing_coaching |>
    filter(content_area == "Other") |>
    select(
      `They demonstrated deep knowledge of the content they coach` = coach_ongoing_feed_1,
      `Their coaching is clear` = coach_ongoing_feed_2,
      `They seem fully prepared for the coaching sessions` = coach_ongoing_feed_3,
      `They effectively build a safe learning environment` = coach_ongoing_feed_4,
      `They make necessary adjustments based on my needs` = coach_ongoing_feed_5
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 30)
    )

  n_size_agree <- ongoing_coaching |>
    filter(content_area == "Other") |>
    count(sort = T)

  ### Percent Agree Strongly Agrees Other ###
  coach_prepared_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They seem fully prepared for<br>the coaching sessions")
  coach_adjustments_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They make necessary<br>adjustments based on my needs")
  coach_effectively_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They effectively build a safe<br>learning environment")
  coach_knowledge_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "They demonstrated deep<br>knowledge of the content they<br>coach")
  coach_clear_coaching_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "Their coaching is clear")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Ongoing Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 17,
        margin = margin(r = -55)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -170),
      legend.text = element_text(size = 15)
    )
} else {
  coach_prepared_agree <- "There was no data to show the % that"
  coach_adjustments_agree <- "There was no data to show the % that"
  coach_effectively_agree <- "There was no data to show the % that"
  coach_knowledge_agree <- "There was no data to show the % that"
  coach_clear_coaching_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_effectively_agree` strongly agree or agree that the coaches
    effectively built a safe learning environment.
-   `r coach_clear_coaching_agree` strongly agree or agree that the
    coaching was clear.
-   `r coach_prepared_agree` strongly agree or agree that the coach
    seemed fully prepared for the coaching sessions.
-   `r coach_adjustments_agree` strongly agree or agree that the coaches
    made necessary adjustments based on their needs.
-   `r coach_knowledge_agree` strongly agree or agree that the coaches
    demonstrated deep knowledge of the content they coach.

Finally, here are some highlights from the qualitative feedback.

### Responses to "What has gone well in your coaching sessions?"

::: {.fold .o}
<center>

```{r gone-well-ongoing-coaching, fig.dim = c(14, 5), eval = T}
quote2 <- ongoing_coaching |>
  select(`What has gone well in your coaching sessions?` = coach_gone_well) |>
  drop_na() |>
  filter(`What has gone well in your coaching sessions?` %!in% na_df) |>
  filter(str_length(`What has gone well in your coaching sessions?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What has gone well in your coaching sessions?`)

if (nrow(quote2) >= 1) {
  quote_viz(
    data = quote2,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab3_2.png"))

  knitr::include_graphics(here::here("images/report_images/tab3_2.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "What could be better about your coaching sessions?"

::: {.fold .o}
<center>

```{r be-better-ongoing-coaching, fig.dim = c(14, 5), eval = T}
quote1 <- ongoing_coaching |>
  select(`What could be better about your coaching sessions?` = been_better_coach) |>
  drop_na() |>
  filter(`What could be better about your coaching sessions?` %!in% na_df) |>
  filter(str_length(`What could be better about your coaching sessions?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What could be better about your coaching sessions?`)

if (nrow(quote1) >= 1) {
  TeachingLab::quote_viz(
    data = quote1,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab3_1.png"))

  knitr::include_graphics(here::here("images/report_images/tab3_1.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "What additional feedback do you have about their coaching skills, if any?"

::: {.fold .o}
<center>

```{r additional-feedback-ongoing-coaching, fig.dim = c(14, 5), eval = T}
quote3 <- ongoing_coaching |>
  select(`What additional feedback do you have about their coaching skills, if any?` = coach_additonal_feed) |>
  drop_na() |>
  filter(`What additional feedback do you have about their coaching skills, if any?` %!in% na_df) |>
  filter(str_length(`What additional feedback do you have about their coaching skills, if any?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What additional feedback do you have about their coaching skills, if any?`)

if (nrow(quote3) >= 1) {
  quote_viz(
    data = quote3,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab3_3.png"))

  knitr::include_graphics(here::here("images/report_images/tab3_3.png"))
} else {
  no_data_plot
}
```

</center>
:::

## Section 2d: End of Coaching Feedback

### Aggregate

::: {.fold .o}
<center>

```{r end-coaching-feedback, fig.width = 12, fig.height = 8}
if (nrow(end_coaching) >= 1) {
  coaching_plot_agree <- end_coaching |>
    select(
      `I looked forward to attending the coaching sessions` = coach_end_feed_1,
      `I was fully present/”minds-on” during the coaching sessions` = coach_end_feed_2,
      `I am satisfied with the coaching I received` = coach_end_feed_3,
      `The coaching was a good use of my time` = coach_end_feed_4,
      `I talk to other teachers about the things I learned from coaching` = coach_end_feed_5,
      `The coaching support was relevant to my instructional practices` = coach_end_feed_6,
      `The strategies I’ve learned through coaching will improve my instruction` = coach_end_feed_7,
      `The strategies I’ve learned through coaching will improve my coaching or supervision of teachers` = coach_end_feed_8,
      `I have applied or will apply what I have learned through coaching to my practice` = coach_end_feed_9,
      `The coaching supported me in being responsive to students' backgrounds, cultures, and points of view` = coach_end_feed_10,
      `I am satisfied with the overall quality of the coaching I received` = coach_end_feed_11
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 40)
    )

  n_size_agree <- end_coaching |>
    count(sort = T)

  ### Percent Agree Strongly Agrees ###
  coach_applied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I have applied or will apply what I have<br>learned through coaching to my practice")
  coach_quality_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the overall quality<br>of the coaching I received")
  coach_supported_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching supported me in being<br>responsive to students' backgrounds,<br>cultures, and points of view")
  coach_looked_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I looked forward to attending the<br>coaching sessions")
  coach_talk_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I talk to other teachers about the<br>things I learned from coaching")
  coach_present_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I was fully present/”minds-on” during<br>the coaching sessions")
  coach_satisfied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the coaching I<br>received")
  coach_relevant_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching support was relevant to my<br>instructional practices")
  coach_improve_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my instruction")
  coach_time_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching was a good use of my time")
  coach_supervision_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my coaching or<br>supervision of teachers")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("End of Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 13, lineheight = 1,
        margin = margin(r = -60)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -120),
      legend.text = element_text(size = 13)
    )
} else {
  coach_applied_agree <- "There was no data to show the % that"
  coach_quality_agree <- "There was no data to show the % that"
  coach_supported_agree <- "There was no data to show the % that"
  coach_looked_agree <- "There was no data to show the % that"
  coach_talk_agree <- "There was no data to show the % that"
  coach_present_agree <- "There was no data to show the % that"
  coach_satisfied_agree <- "There was no data to show the % that"
  coach_relevant_agree <- "There was no data to show the % that"
  coach_improve_agree <- "There was no data to show the % that"
  coach_time_agree <- "There was no data to show the % that"
  coach_supervision_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_looked_agree` strongly agree or agree that they looked
    forward to attending the coaching sessions.
-   `r coach_present_agree` strongly agree or agree that they were fully
    present/"minds-on" during the coaching sessions.
-   `r coach_satisfied_agree` strongly agree or agree that they were
    satisfied with the coaching they received.
-   `r coach_time_agree` strongly agree or agree that the coaching was a
    good use of their time.
-   `r coach_talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned from coaching.
-   `r coach_relevant_agree` strongly agree or agree that the coaching
    was relevant to their instructional practices.
-   `r coach_improve_agree` strongly agree or agree that the strategies
    they've learned through coaching will improve their instruction.
-   `r coach_supervision_agree` strongly agree or agree that the
    strategies they've learned through coaching will improve their
    coaching or supervision or teachers.
-   `r coach_applied_agree` strongly agree or agree that they have
    applied or will apply what they have learned through coaching to
    their practice.
-   `r coach_supported_agree` strongly agree or agree that the coaching
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r coach_quality_agree` strongly agree or agree that they were
    satisfied with the overall quality of the coaching they received.

### Math

::: {.fold .o}
<center>

```{r end-math-coaching-feedback, fig.width = 12, fig.height = 8}
if (nrow(end_coaching[end_coaching$content_area == "Math", ]) >= 1) {
  coaching_plot_agree <- end_coaching |>
    filter(content_area == "Math") |>
    select(
      `I looked forward to attending the coaching sessions` = coach_end_feed_1,
      `I was fully present/”minds-on” during the coaching sessions` = coach_end_feed_2,
      `I am satisfied with the coaching I received` = coach_end_feed_3,
      `The coaching was a good use of my time` = coach_end_feed_4,
      `I talk to other teachers about the things I learned from coaching` = coach_end_feed_5,
      `The coaching support was relevant to my instructional practices` = coach_end_feed_6,
      `The strategies I’ve learned through coaching will improve my instruction` = coach_end_feed_7,
      `The strategies I’ve learned through coaching will improve my coaching or supervision of teachers` = coach_end_feed_8,
      `I have applied or will apply what I have learned through coaching to my practice` = coach_end_feed_9,
      `The coaching supported me in being responsive to students' backgrounds, cultures, and points of view` = coach_end_feed_10,
      `I am satisfied with the overall quality of the coaching I received` = coach_end_feed_11
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 40)
    )

  n_size_agree <- end_coaching |>
    filter(content_area == "Math") |>
    count(sort = T)

  ### Percent Agree Strongly Agrees ###
  coach_applied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I have applied or will apply what I have<br>learned through coaching to my practice")
  coach_quality_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the overall quality<br>of the coaching I received")
  coach_supported_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching supported me in being<br>responsive to students' backgrounds,<br>cultures, and points of view")
  coach_looked_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I looked forward to attending the<br>coaching sessions")
  coach_talk_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I talk to other teachers about the<br>things I learned from coaching")
  coach_present_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I was fully present/”minds-on” during<br>the coaching sessions")
  coach_satisfied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the coaching I<br>received")
  coach_relevant_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching support was relevant to my<br>instructional practices")
  coach_improve_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my instruction")
  coach_time_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching was a good use of my time")
  coach_supervision_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my coaching or<br>supervision of teachers")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("End of Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 13, lineheight = 1,
        margin = margin(r = -60)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -120),
      legend.text = element_text(size = 13)
    )
} else {
  coach_applied_agree <- "There was no data to show the % that"
  coach_quality_agree <- "There was no data to show the % that"
  coach_supported_agree <- "There was no data to show the % that"
  coach_looked_agree <- "There was no data to show the % that"
  coach_talk_agree <- "There was no data to show the % that"
  coach_present_agree <- "There was no data to show the % that"
  coach_satisfied_agree <- "There was no data to show the % that"
  coach_relevant_agree <- "There was no data to show the % that"
  coach_improve_agree <- "There was no data to show the % that"
  coach_time_agree <- "There was no data to show the % that"
  coach_supervision_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_looked_agree` strongly agree or agree that they looked
    forward to attending the coaching sessions.
-   `r coach_present_agree` strongly agree or agree that they were fully
    present/"minds-on" during the coaching sessions.
-   `r coach_satisfied_agree` strongly agree or agree that they were
    satisfied with the coaching they received.
-   `r coach_time_agree` strongly agree or agree that the coaching was a
    good use of their time.
-   `r coach_talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned from coaching.
-   `r coach_relevant_agree` strongly agree or agree that the coaching
    was relevant to their instructional practices.
-   `r coach_improve_agree` strongly agree or agree that the strategies
    they've learned through coaching will improve their instruction.
-   `r coach_supervision_agree` strongly agree or agree that the
    strategies they've learned through coaching will improve their
    coaching or supervision or teachers.
-   `r coach_applied_agree` strongly agree or agree that they have
    applied or will apply what they have learned through coaching to
    their practice.
-   `r coach_supported_agree` strongly agree or agree that the coaching
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r coach_quality_agree` strongly agree or agree that they were
    satisfied with the overall quality of the coaching they received.

### ELA

::: {.fold .o}
<center>

```{r end-ela-coaching-feedback, fig.width = 12, fig.height = 8}
if (nrow(end_coaching[end_coaching$content_area == "ELA", ]) >= 1) {
  coaching_plot_agree <- end_coaching |>
    filter(content_area == "ELA") |>
    select(
      `I looked forward to attending the coaching sessions` = coach_end_feed_1,
      `I was fully present/”minds-on” during the coaching sessions` = coach_end_feed_2,
      `I am satisfied with the coaching I received` = coach_end_feed_3,
      `The coaching was a good use of my time` = coach_end_feed_4,
      `I talk to other teachers about the things I learned from coaching` = coach_end_feed_5,
      `The coaching support was relevant to my instructional practices` = coach_end_feed_6,
      `The strategies I’ve learned through coaching will improve my instruction` = coach_end_feed_7,
      `The strategies I’ve learned through coaching will improve my coaching or supervision of teachers` = coach_end_feed_8,
      `I have applied or will apply what I have learned through coaching to my practice` = coach_end_feed_9,
      `The coaching supported me in being responsive to students' backgrounds, cultures, and points of view` = coach_end_feed_10,
      `I am satisfied with the overall quality of the coaching I received` = coach_end_feed_11
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 40)
    )

  n_size_agree <- end_coaching |>
    filter(content_area == "ELA") |>
    count(sort = T)

  ### Percent Agree Strongly Agrees ###
  coach_applied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I have applied or will apply what I have<br>learned through coaching to my practice")
  coach_quality_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the overall quality<br>of the coaching I received")
  coach_supported_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching supported me in being<br>responsive to students' backgrounds,<br>cultures, and points of view")
  coach_looked_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I looked forward to attending the<br>coaching sessions")
  coach_talk_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I talk to other teachers about the<br>things I learned from coaching")
  coach_present_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I was fully present/”minds-on” during<br>the coaching sessions")
  coach_satisfied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the coaching I<br>received")
  coach_relevant_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching support was relevant to my<br>instructional practices")
  coach_improve_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my instruction")
  coach_time_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching was a good use of my time")
  coach_supervision_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my coaching or<br>supervision of teachers")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("End of Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 13, lineheight = 1,
        margin = margin(r = -60)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -120),
      legend.text = element_text(size = 13)
    )
} else {
  coach_applied_agree <- "There was no data to show the % that"
  coach_quality_agree <- "There was no data to show the % that"
  coach_supported_agree <- "There was no data to show the % that"
  coach_looked_agree <- "There was no data to show the % that"
  coach_talk_agree <- "There was no data to show the % that"
  coach_present_agree <- "There was no data to show the % that"
  coach_satisfied_agree <- "There was no data to show the % that"
  coach_relevant_agree <- "There was no data to show the % that"
  coach_improve_agree <- "There was no data to show the % that"
  coach_time_agree <- "There was no data to show the % that"
  coach_supervision_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_looked_agree` strongly agree or agree that they looked
    forward to attending the coaching sessions.
-   `r coach_present_agree` strongly agree or agree that they were fully
    present/"minds-on" during the coaching sessions.
-   `r coach_satisfied_agree` strongly agree or agree that they were
    satisfied with the coaching they received.
-   `r coach_time_agree` strongly agree or agree that the coaching was a
    good use of their time.
-   `r coach_talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned from coaching.
-   `r coach_relevant_agree` strongly agree or agree that the coaching
    was relevant to their instructional practices.
-   `r coach_improve_agree` strongly agree or agree that the strategies
    they've learned through coaching will improve their instruction.
-   `r coach_supervision_agree` strongly agree or agree that the
    strategies they've learned through coaching will improve their
    coaching or supervision or teachers.
-   `r coach_applied_agree` strongly agree or agree that they have
    applied or will apply what they have learned through coaching to
    their practice.
-   `r coach_supported_agree` strongly agree or agree that the coaching
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r coach_quality_agree` strongly agree or agree that they were
    satisfied with the overall quality of the coaching they received.

### Other

::: {.fold .o}
<center>

```{r end-other-coaching-feedback, fig.width = 12, fig.height = 8}
if (nrow(end_coaching[end_coaching$content_area == "Other", ]) >= 1) {
  coaching_plot_agree <- end_coaching |>
    filter(content_area == "Other") |>
    select(
      `I looked forward to attending the coaching sessions` = coach_end_feed_1,
      `I was fully present/”minds-on” during the coaching sessions` = coach_end_feed_2,
      `I am satisfied with the coaching I received` = coach_end_feed_3,
      `The coaching was a good use of my time` = coach_end_feed_4,
      `I talk to other teachers about the things I learned from coaching` = coach_end_feed_5,
      `The coaching support was relevant to my instructional practices` = coach_end_feed_6,
      `The strategies I’ve learned through coaching will improve my instruction` = coach_end_feed_7,
      `The strategies I’ve learned through coaching will improve my coaching or supervision of teachers` = coach_end_feed_8,
      `I have applied or will apply what I have learned through coaching to my practice` = coach_end_feed_9,
      `The coaching supported me in being responsive to students' backgrounds, cultures, and points of view` = coach_end_feed_10,
      `I am satisfied with the overall quality of the coaching I received` = coach_end_feed_11
    ) |>
    pivot_longer(everything(), names_to = "Question", values_to = "Response") |>
    drop_na(Response) |>
    group_by(Question, Response) |>
    count(sort = T) |>
    ungroup() |>
    group_by(Question) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Response = factor(Response, levels = c(
        "1 - Strongly disagree",
        "2 - Disagree",
        "3 - Neither agree nor disagree",
        "4 - Agree",
        "5 - Strongly agree"
      )),
      Question = TeachingLab::html_wrap(Question, n = 40)
    )

  n_size_agree <- end_coaching |>
    filter(content_area == "Other") |>
    count(sort = T)

  ### Percent Agree Strongly Agrees ###
  coach_applied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I have applied or will apply what I have<br>learned through coaching to my practice")
  coach_quality_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the overall quality<br>of the coaching I received")
  coach_supported_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching supported me in being<br>responsive to students' backgrounds,<br>cultures, and points of view")
  coach_looked_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I looked forward to attending the<br>coaching sessions")
  coach_talk_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I talk to other teachers about the<br>things I learned from coaching")
  coach_present_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I was fully present/”minds-on” during<br>the coaching sessions")
  coach_satisfied_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "I am satisfied with the coaching I<br>received")
  coach_relevant_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching support was relevant to my<br>instructional practices")
  coach_improve_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my instruction")
  coach_time_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The coaching was a good use of my time")
  coach_supervision_agree <- coaching_plot_agree |>
    agree_strongly_agree(question = "The strategies I’ve learned through<br>coaching will improve my coaching or<br>supervision of teachers")

  coaching_plot_agree |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      Question = factor(Question)
    ) |>
    ggplot(aes(
      x = fct_reorder(Question, Percent, .desc = T),
      y = Percent,
      color = Response,
      fill = Response
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), ""),
      color = Response
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6.5
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("End of Coaching Participant Feedback (n = {sum(n_size_agree$n, na.rm = T)})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "black",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_final_report() +
    theme(
      axis.text.y = element_markdown(
        size = 13, lineheight = 1,
        margin = margin(r = -60)
      ),
      plot.title = element_text(size = 25),
      legend.margin = margin(-30, 0, 0, -120),
      legend.text = element_text(size = 13)
    )
} else {
  coach_applied_agree <- "There was no data to show the % that"
  coach_quality_agree <- "There was no data to show the % that"
  coach_supported_agree <- "There was no data to show the % that"
  coach_looked_agree <- "There was no data to show the % that"
  coach_talk_agree <- "There was no data to show the % that"
  coach_present_agree <- "There was no data to show the % that"
  coach_satisfied_agree <- "There was no data to show the % that"
  coach_relevant_agree <- "There was no data to show the % that"
  coach_improve_agree <- "There was no data to show the % that"
  coach_time_agree <- "There was no data to show the % that"
  coach_supervision_agree <- "There was no data to show the % that"

  no_data_plot
}
```

</center>
:::

In summary, we see the following % agree or strongly agree with the
above statements:

-   `r coach_looked_agree` strongly agree or agree that they looked
    forward to attending the coaching sessions.
-   `r coach_present_agree` strongly agree or agree that they were fully
    present/"minds-on" during the coaching sessions.
-   `r coach_satisfied_agree` strongly agree or agree that they were
    satisfied with the coaching they received.
-   `r coach_time_agree` strongly agree or agree that the coaching was a
    good use of their time.
-   `r coach_talk_agree` strongly agree or agree that they talk to other
    teachers about the things they learned from coaching.
-   `r coach_relevant_agree` strongly agree or agree that the coaching
    was relevant to their instructional practices.
-   `r coach_improve_agree` strongly agree or agree that the strategies
    they've learned through coaching will improve their instruction.
-   `r coach_supervision_agree` strongly agree or agree that the
    strategies they've learned through coaching will improve their
    coaching or supervision or teachers.
-   `r coach_applied_agree` strongly agree or agree that they have
    applied or will apply what they have learned through coaching to
    their practice.
-   `r coach_supported_agree` strongly agree or agree that the coaching
    supported me in being responsive to students' backgrounds, cultures,
    and points of view.
-   `r coach_quality_agree` strongly agree or agree that they were
    satisfied with the overall quality of the coaching they received.

Several samplings of the textual feedback from the course survey are
presented below.

### Responses to "What is the learning that you are most excited about?"

::: {.fold .o}
<center>

```{r coach-course-quote-1, fig.dim = c(14, 5), eval = T}
quote1 <- end_coaching |>
  select(`What is the learning that you are most excited about?` = coach_learn_excited) |>
  drop_na() |>
  filter(`What is the learning that you are most excited about?` %!in% na_df) |>
  filter(str_length(`What is the learning that you are most excited about?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`What is the learning that you are most excited about?`)

if (nrow(quote1) >= 1) {
  quote_viz(
    data = quote1,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab4_1.png"))

  knitr::include_graphics(here::here("images/report_images/tab4_1.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "Which activities best supported your learning during the coaching support?"

::: {.fold .o}
<center>

```{r coach-course-quote-2, fig.dim = c(14, 5), eval = T}
quote2 <- end_coaching |>
  select(`Which activities best supported your learning during the coaching support?` = coach_activities_sup) |>
  drop_na() |>
  filter(`Which activities best supported your learning during the coaching support?` %!in% na_df) |>
  filter(str_length(`Which activities best supported your learning during the coaching support?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Which activities best supported your learning during the coaching support?`)

if (nrow(quote2) >= 1) {
  quote_viz(
    data = quote2,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab4_2.png"))

  knitr::include_graphics(here::here("images/report_images/tab4_2.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "Overall, what went well during coaching?"

::: {.fold .o}
<center>

```{r went-well-end-coaching, fig.dim = c(14, 5), eval = T}
quote3 <- end_coaching |>
  select(`Overall, what went well during coaching?` = coach_went_well) |>
  drop_na() |>
  filter(`Overall, what went well during coaching?` %!in% na_df) |>
  filter(str_length(`Overall, what went well during coaching?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Overall, what went well during coaching?`)

if (nrow(quote3) >= 1) {
  quote_viz(
    data = quote3,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab4_3.png"))

  knitr::include_graphics(here::here("images/report_images/tab4_3.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "Overall, what could have been better about the coaching?"

::: {.fold .o}
<center>

```{r went-better-end-coaching, fig.dim = c(14, 5), eval = T}
quote4 <- end_coaching |>
  select(`Overall, what could have been better about the coaching?` = coach_been_better) |>
  drop_na() |>
  filter(`Overall, what could have been better about the coaching?` %!in% na_df) |>
  filter(str_length(`Overall, what could have been better about the coaching?`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Overall, what could have been better about the coaching?`)

if (nrow(quote4) >= 1) {
  quote_viz(
    data = quote4,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab4_4.png"))

  knitr::include_graphics(here::here("images/report_images/tab4_4.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Responses to "Feel free to leave us any additional comments, concerns, or questions."

::: {.fold .o}
<center>

```{r add-comment-end-coaching, fig.dim = c(14, 5), eval = T}
quote5 <- end_coaching |>
  select(`Feel free to leave us any additional comments, concerns, or questions.` = coach_add_comment) |>
  drop_na() |>
  filter(`Feel free to leave us any additional comments, concerns, or questions.` %!in% na_df) |>
  filter(str_length(`Feel free to leave us any additional comments, concerns, or questions.`) > 30) |>
  conditional_slice_sample(max = 15) |>
  distinct(`Feel free to leave us any additional comments, concerns, or questions.`)

if (nrow(quote5) >= 1) {
  quote_viz(
    data = quote5,
    viz_type = "gt",
    print = F,
    n = 5,
    width = 80,
    align = "center"
  ) |>
    gtsave(here::here("images/report_images/tab4_5.png"))

  knitr::include_graphics(here::here("images/report_images/tab4_5.png"))
} else {
  no_data_plot
}
```

</center>
:::

# Section 3: Participant Knowledge/Self-Reported Practices Assessments

For most PL courses, Teaching Lab administers a pre- and post- content knowledge or self-reported practice assessment. Below the pre and post averages are visualized by assessment.

```{r test-titles}
unique_tables <- unique(knowledge_assessments$know_assess)
# for (i in 1:length(unique_tables)) {
#   cat(paste0("<center>", unique_tables[i], "</center>"))
# }
```

## Results {.tabset}

::: {.fold .o}
<center>

```{r knowledge-assessments-summary, fig.dim = c(6,6)}
n_know_size <- knowledge_assessments |>
  # dplyr::filter(prepost == "post") |>
  dplyr::group_by(know_assess) |>
  dplyr::count() |>
  dplyr::ungroup() |>
  dplyr::summarise(n = sum(n)) |>
  dplyr::first() >= 5

if (nrow(knowledge_assessments) == 0) {
  n_know_size <- T # True so it can recognize there are no tables to make
}

# Same but slightly faster method for saving image files to display in next chunk
if (n_know_size | params$partner == "US_Digital Nest") {
  if (length(unique_tables) > 0) {
    for (i in 1:length(unique_tables)) {
      TeachingLab::know_assess_summary(knowledge_assessments, unique_tables[i])
    }

    ### Conditional logic to add specialized digital nest charts ###
    if (params$partner %in% c("US_Digital Nest", "All Sites")) {
      knitr::include_graphics(c(list.files(here::here("images/report_summary_images"), full.names = T),
                                "/Users/dunk/Teaching Lab/Coding/TeachingLab/images/digital_nest_summary_images/q78_summary_1.png",
                                "/Users/dunk/Teaching Lab/Coding/TeachingLab/images/digital_nest_summary_images/q77_summary_1.png"))
    } else {
        knitr::include_graphics(list.files(here::here("images/report_summary_images"), full.names = T))
      }
    
  } else {
    no_data_plot
  }
} else {
  ggplot(tibble(text = "No data to show as n < 5", x = 0, y = 0)) +
    geom_text(aes(label = text, x, y),
      fontface = "bold",
      size = 10, family = "Calibri Bold"
    ) +
    theme_void()
}
```

</center>
:::


# Section 4: Teachers' Mindsets & School Environment

Participants complete Teaching Lab’s Educator Survey twice a year: at the beginning and end of their participation in PL. The survey collects data on teachers’ mindsets, perception and use of curricula, and perceptions of school culture and climate. 

## Section 4a: Teacher - Mindsets

Teachers responded to several items about mindsets, related to recognizing race and culture, the need for remediation, high expectations for all students, and growth mindsets on a 5-point Likert scale. Composite measures were created for each construct by reverse coding some items and then averaging responses across items. In this way, higher scores correspond to holding equitable mindsets.


### Overall 

::: {.fold .o}
<center>

```{r teacher-mindsets-overall, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`mindsets_ts_1_1`)) >= 1) {
  n_size <- sum(!is.na(educator_survey$`mindsets_ts_1_1`))

  teacher_mindsets <- educator_survey |>
    select(contains("Mindsets Ts")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "mindsets_ts_1_2" = "The gap in the achievement among students of different races is about poverty, not race",
      "mindsets_ts_1_3" = "I think about my own background and experiences and how those affect my instruction",
      "mindsets_ts_1_4" = "I try to keep in mind the limits of my students’ ability and give them assignments that I know they can do so that they do not become discouraged",
      "mindsets_ts_1_5" = "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
      "mindsets_ts_1_6" = "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
      "mindsets_ts_1_7" = "Teachers should provide all students the opportunity to work with grade-level texts and tasks",
      "mindsets_ts_1_8" = "Students of all ethnic or cultural backgrounds can be successful in my classroom",
      "mindsets_ts_1_9" = "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my classroom",
      "mindsets_ts_1_10" = "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my classroom",
      "mindsets_ts_1_11" = "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
      "mindsets_ts_1_12" = "Students who come into my classroom behind grade level will have a hard time succeeding",
      "mindsets_ts_1_13" = "Students have a certain amount of intelligence, and they can’t really do much to change it",
      "mindsets_ts_1_14" = "Intelligence is something about students that they can’t change very much",
      "mindsets_ts_1_15" = "Students can learn new things, but they can’t really change their basic intelligence",
      "mindsets_ts_1_1" = "I am color blind when it comes to my teaching - I don’t think of my students in terms of their race or ethnicity"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    ungroup()

  # teacher_mindsets_1 <- teacher_mindsets |>

  teacher_mindsets |>
    mutate(
      pos_neg = case_when(
        str_detect(name, "race") ~ "negative",
        name %in% c(
          "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
          "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
          "I try to keep in mind the limits of my students’ ability and give them assignments that I know they can do so that they do not become discouraged",
          "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
          "Students who come into my classroom behind grade level will have a hard time succeeding",
          "Students can learn new things, but they can’t really change their basic intelligence",
          "Students have a certain amount of intelligence, and they can’t really do much to change it",
          "Intelligence is something about students that they can’t change very much"
        ) ~ "negative",
        TRUE ~ "positive"
      ),
      ` ` = case_when(
        str_detect(name, "race|own background") ~ "Recognition of Race & Culture",
        name %in% c(
          "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
          "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
          "I try to keep in mind the limits of my students’ ability and give them assignments that I know they can do so that they do not become discouraged",
          "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
          "Students who come into my classroom behind grade level will have a hard time succeeding"
        ) ~ "Need for Remediation",
        name %in% c(
          "Students of all ethnic or cultural backgrounds can be successful in my classroom",
          "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my classroom",
          "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my classroom",
          "Teachers should provide all students the opportunity to work with grade-level texts and tasks"
        ) ~ "High Expectations",
        name %in% c(
          "Students can learn new things, but they can’t really change their basic intelligence",
          "Students have a certain amount of intelligence, and they can’t really do much to change it",
          "Intelligence is something about students that they can’t change very much"
        ) ~ "Growth Mindsets"
      ),
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    # dplyr::mutate(id = paste0(tolower(initials), dob),
    #                 know_assess = "ELA ANA") |>
    #   dplyr::group_by(id) |>
    #   dplyr::mutate(n_response = dplyr::n(), # Get number of responses by person, sometimes there are more than 2 :/
    #                 maxdate = max(RecordedDate), # Get max date of creation for most recent response
    #                 matched = dplyr::if_else(n_response > 1 & maxdate == RecordedDate, "post", "pre")) |> # Define as post for matched if more than 1 response and date is max of date_created
    #   dplyr::mutate(matched = factor(matched, levels = c("pre", "post"))) |> # Make matched a factor
    #   dplyr::mutate(prepost = dplyr::if_else(RecordedDate >= maxdate & n_response > 1, "post", "pre")) |> # Make pre and post defined by pre-October and post-October
    #   dplyr::mutate(prepost = factor(prepost, levels = c("pre", "post"))) |> # Make prepost a factor
    #   dplyr::ungroup() |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(
      score = sum(score),
      ` ` = min(` `)
    ) |>
    ungroup() |>
    group_by(` `) |>
    summarise(Score = mean(score)) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_teacher_mindsets_overall.png"))

  knitr::include_graphics(here::here("images/report_images/tab_teacher_mindsets_overall.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Recognition of Race & Culture

::: {.fold .o}
<center>

```{r teacher-mindsets-1, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`mindsets_ts_1_1`)) >= 1) {
  n_size <- sum(!is.na(educator_survey$`mindsets_ts_1_1`))

  teacher_mindsets <- educator_survey |>
    select(contains("Mindsets Ts")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "mindsets_ts_1_2" = "The gap in the achievement among students of different races is about poverty, not race",
      "mindsets_ts_1_3" = "I think about my own background and experiences and how those affect my instruction",
      "mindsets_ts_1_4" = "I try to keep in mind the limits of my students’ ability and give them assignments that I know they can do so that they do not become discouraged",
      "mindsets_ts_1_5" = "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
      "mindsets_ts_1_6" = "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
      "mindsets_ts_1_7" = "Teachers should provide all students the opportunity to work with grade-level texts and tasks",
      "mindsets_ts_1_8" = "Students of all ethnic or cultural backgrounds can be successful in my classroom",
      "mindsets_ts_1_9" = "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my classroom",
      "mindsets_ts_1_10" = "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my classroom",
      "mindsets_ts_1_11" = "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
      "mindsets_ts_1_12" = "Students who come into my classroom behind grade level will have a hard time succeeding",
      "mindsets_ts_1_13" = "Students have a certain amount of intelligence, and they can’t really do much to change it",
      "mindsets_ts_1_14" = "Intelligence is something about students that they can’t change very much",
      "mindsets_ts_1_15" = "Students can learn new things, but they can’t really change their basic intelligence",
      "mindsets_ts_1_1" = "I am color blind when it comes to my teaching - I don’t think of my students in terms of their race or ethnicity"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    ungroup() #|>
  # mutate(name = html_wrap(name, 40)) |>
  # group_by(name) |>
  # mutate(Percent = round(100 * n / sum(n), 2))

  # teacher_mindsets_1 <- teacher_mindsets |>

  teacher_mindsets |>
    filter(str_detect(name, "color blind|own background|in the achievement")) |>
    mutate(
      pos_neg = case_when(
        str_detect(name, "race") ~ "negative",
        TRUE ~ "positive"
      ),
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_teacher_mindsets_1.png"))

  knitr::include_graphics(here::here("images/report_images/tab_teacher_mindsets_1.png"))

  #   ggplot(aes(
  #     x = fct_reorder(name, Percent, .desc = T),
  #     y = Percent,
  #     color = value,
  #     fill = value
  #   )) +
  #   geom_col(color = NA, position = position_stack(reverse = TRUE)) +
  #   geom_text(aes(
  #     label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
  #   ),
  #   position = position_stack(vjust = 0.5, reverse = TRUE),
  #   fontface = "bold",
  #   size = 9
  #   ) +
  #   labs(
  #     x = "", y = "",
  #     title = glue::glue("Teacher Mindsets: Recognition of Race & Culture (n = {n_size})"),
  #     fill = ""
  #   ) +
  #   scale_fill_manual(values = c(
  #   "1 - Strongly disagree" = "#040404",
  #   "2 - Disagree" = "#032E3F",
  #   "3 - Neither agree nor disagree" = "#02587A",
  #   "4 - Agree" = "#0182B4",
  #   "5 - Strongly agree" = "#00ACF0"
  # )) +
  # scale_color_manual(values = c(
  #   "1 - Strongly disagree" = "white",
  #   "2 - Disagree" = "black",
  #   "3 - Neither agree nor disagree" = "black",
  #   "4 - Agree" = "black",
  #   "5 - Strongly agree" = "black"
  # )) +
  #   guides(
  #     fill = guide_legend(),
  #     color = "none"
  #   ) +
  #   scale_y_continuous(
  #     labels = scales::label_percent(scale = 1),
  #     expand = c(0.14, 0)
  #   ) +
  #   coord_flip() +
  #   theme_tl() +
  #   theme(
  #     axis.text.y = element_markdown(margin = margin(t = 0, l = 0, r = -55, b = 0),
  #                                  size = 20),
  #     plot.title = element_text(size = 25, face = "bold"),
  #     legend.position = "bottom",
  #     legend.key.height = unit(1.3, "cm"),
  #     legend.key.width = unit(1.3, "cm"),
  #     legend.key.size = unit(0.75, "cm"),
  #     legend.text = element_text(size = 13),
  #     legend.margin = margin(-25, 0, 0, 0)
  #   )
} else {
  no_data_plot
}
```

</center>
:::

### Need for Remediation

::: {.fold .o}
<center>

```{r teacher-mindsets-2, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`mindsets_ts_1_1`)) >= 1) {
  teacher_mindsets |>
    filter(name %in% c(
      "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
      "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
      "I try to keep in mind the limits of my students’ ability and give them assignments that I know they can do so that they do not become discouraged",
      "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
      "Students who come into my classroom behind grade level will have a hard time succeeding"
    )) |>
    mutate(
      pos_neg = "negative",
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_teacher_mindsets_2.png"))

  knitr::include_graphics(here::here("images/report_images/tab_teacher_mindsets_2.png"))
} else {
  no_data_plot
}
```

</center>
:::

### High Expectations

::: {.fold .o}
<center>

```{r teacher-mindsets-3, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`mindsets_ts_1_1`)) >= 1) {
  teacher_mindsets |>
    filter(name %in% c(
      "Students of all ethnic or cultural backgrounds can be successful in my classroom",
      "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my classroom",
      "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my classroom",
      "Teachers should provide all students the opportunity to work with grade-level texts and tasks"
    )) |>
    mutate(
      pos_neg = "positive",
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_teacher_mindsets_3.png"))

  knitr::include_graphics(here::here("images/report_images/tab_teacher_mindsets_3.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Growth Mindsets

::: {.fold .o}
<center>

```{r teacher-mindsets-4, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`mindsets_ts_1_1`)) >= 1) {
  teacher_mindsets |>
    filter(name %in% c(
      "Students can learn new things, but they can’t really change their basic intelligence",
      "Students have a certain amount of intelligence, and they can’t really do much to change it",
      "Intelligence is something about students that they can’t change very much"
    )) |>
    mutate(
      pos_neg = "negative",
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_teacher_mindsets_4.png"))

  knitr::include_graphics(here::here("images/report_images/tab_teacher_mindsets_4.png"))
  
} else {
  no_data_plot
}
```

</center>
:::

## Section 4b: Teachers - Perceptions and Use of Curricula

Teachers responded about the different curricula they use regularly and
the most often. Overall we see the following results.

### Aggregate

::: {.fold .o}
<center>

```{r perceptions-curricula-1, fig.width = 8, fig.height = 5}
if (sum(!is.na(educator_survey$materials_1[!str_detect(educator_survey$materials_1, "NA")])) >= 1) {
  n_size <- sum(!is.na(educator_survey$materials_1[!str_detect(educator_survey$materials_1, "NA")]))

  educator_survey |>
    select(contains("materials")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "materials_1" = "curriculum materials adopted by your district",
      "materials_2" = "materials developed by your school or district",
      "materials_3" = "materials you found on the internet",
      "materials_4" = "materials developed by yourself or with colleagues"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(
      name = html_wrap(name, 25),
      value = str_wrap(value, 20)
    ) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Never use",
        "Sometimes (once a\nmonth)",
        "Use often (once or\ntwice weekly)",
        "Use everyday"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "Please indicate the extent to which you use...", y = "",
      title = glue::glue("Teacher Curriculum Usage (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Never use" = "#032E3F",
      "Sometimes (once a\nmonth)" = "#02587A",
      "Use often (once or\ntwice weekly)" = "#0182B4",
      "Use everyday" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Never use" = "white",
      "Sometimes (once a\nmonth)" = "black",
      "Use often (once or\ntwice weekly)" = "black",
      "Use everyday" = "black"
    )) +
    guides(
      fill = guide_legend()
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    guides(color = "none") +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 16
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -150)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r perceptions-curricula-2, fig.width = 8.75, fig.height = 3}
if (sum(!is.na(educator_survey$lesson_modifications[!str_detect(educator_survey$lesson_modifications, "NA")])) >= 1) {
  n_size <- sum(!is.na(educator_survey$lesson_modifications[!str_detect(educator_survey$lesson_modifications, "NA")]))

  educator_survey |>
    select(lesson_modifications) |>
    drop_na() |>
    filter(!str_detect(lesson_modifications, "NA")) |>
    group_by(lesson_modifications) |>
    count(sort = T) |>
    ungroup() |>
    mutate(
      lesson_modifications = str_wrap(lesson_modifications, 20),
      Percent = round(100 * n / sum(n), 2),
      lesson_modifications = factor(lesson_modifications, levels = c(
        "with no or few\nmodifications",
        "with modifications\nto less than half of\na lesson plan",
        "with modifications\nto more than half of\na lesson plan",
        "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans"
      ))
    ) |>
    ggplot(aes(
      x = 0,
      y = Percent,
      fill = lesson_modifications
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE), width = 1) +
    geom_text(aes(
      color = lesson_modifications,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "I typically use lessons with...", y = "",
      title = glue::glue("Teachers' use of lessons from district or\nschool-adopted materials (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "with no or few\nmodifications" = "#032E3F",
      "with modifications\nto less than half of\na lesson plan" = "#02587A",
      "with modifications\nto more than half of\na lesson plan" = "#0182B4",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "with no or few\nmodifications" = "white",
      "with modifications\nto less than half of\na lesson plan" = "white",
      "with modifications\nto more than half of\na lesson plan" = "black",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_blank(),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, 0)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r perceptions-curricula-3, fig.width = 10, fig.height = 7}
if (sum(!is.na(educator_survey$curriculum_sch_dist_1[!str_detect(educator_survey$curriculum_sch_dist_1, "NA")])) >= 1) {
  n_size <- sum(!is.na(educator_survey$curriculum_sch_dist_1[!str_detect(educator_survey$curriculum_sch_dist_1, "NA")]))

  educator_survey |>
    select(contains("curriculum_sch_dist")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "curriculum_sch_dist_1" = "The curriculum materials adopted by my school or district are well-suited to the needs of my students",
      "curriculum_sch_dist_2" = "The  curriculum materials adopted by my school or district offer students high-quality opportunities to learn.",
      "curriculum_sch_dist_3" = "The  curriculum materials adopted by my school or district are well-organized and easy to use.",
      "curriculum_sch_dist_4" = "I like the  curriculum materials adopted by my school or district.",
      "curriculum_sch_dist_5" = "The  curriculum materials adopted by my school or district will help my students learn.",
      "curriculum_sch_dist_6" = "The  curriculum materials adopted by my school are too scripted and don't provide me with enough autonomy."
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 25)) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Strongly disagree",
        "Disagree",
        "Neither agree nor disagree",
        "Agree",
        "Strongly agree"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 8
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Teacher perceptions of curriculum (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Strongly disagree" = "#040404",
      "Disagree" = "#032E3F",
      "Neither agree nor disagree" = "#02587A",
      "Agree" = "#0182B4",
      "Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Strongly disagree" = "white",
      "Disagree" = "white",
      "Neither agree nor disagree" = "black",
      "Agree" = "black",
      "Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 13.5
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -80)
    )
} else {
  no_data_plot
}
```

</center>
:::

### Math

Teachers responded about the different curricula they use regularly and
the most often. For math we see the following results.

::: {.fold .o}
<center>

```{r math-perceptions-curricula-1, fig.width = 8, fig.height = 5}
if (sum(!is.na(educator_survey$materials_1[educator_survey$content_area == "Mathematics"])) >= 1) {
  n_size <- sum(!is.na(educator_survey$materials_1[educator_survey$content_area == "Mathematics" & !str_detect(educator_survey$materials_1, "NA")]))

  educator_survey |>
    filter(content_area == "Mathematics") |>
    select(contains("materials")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "materials_1" = "curriculum materials adopted by your district",
      "materials_2" = "materials developed by your school or district",
      "materials_3" = "materials you found on the internet",
      "materials_4" = "materials developed by yourself or with colleagues"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(
      name = html_wrap(name, 25),
      value = str_wrap(value, 20)
    ) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Never use",
        "Sometimes (once a\nmonth)",
        "Use often (once or\ntwice weekly)",
        "Use everyday"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "Please indicate the extent to which you use...", y = "",
      title = glue::glue("Teacher Curriculum Usage (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Never use" = "#032E3F",
      "Sometimes (once a\nmonth)" = "#02587A",
      "Use often (once or\ntwice weekly)" = "#0182B4",
      "Use everyday" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Never use" = "white",
      "Sometimes (once a\nmonth)" = "black",
      "Use often (once or\ntwice weekly)" = "black",
      "Use everyday" = "black"
    )) +
    guides(
      fill = guide_legend()
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    guides(color = "none") +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 16
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -150)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r math-perceptions-curricula-2, fig.width = 8.75, fig.height = 3}
if (sum(!is.na(educator_survey$lesson_modifications[educator_survey$content_area == "Mathematics"])) >= 1 & nrow(educator_survey) >= 1 & params$partner != "NY_Channel View School for Research") {
  
  n_size <- sum(!is.na(educator_survey$lesson_modifications[educator_survey$content_area == "Mathematics" & !str_detect(educator_survey$lesson_modifications, "NA")]))

  educator_survey |>
    filter(content_area == "Mathematics") |>
    select(lesson_modifications) |>
    drop_na() |>
    filter(!str_detect(lesson_modifications, "NA")) |>
    group_by(lesson_modifications) |>
    count(sort = T) |>
    ungroup() |>
    mutate(
      lesson_modifications = str_wrap(lesson_modifications, 20),
      Percent = round(100 * n / sum(n), 2),
      lesson_modifications = factor(lesson_modifications, levels = c(
        "with no or few\nmodifications",
        "with modifications\nto less than half of\na lesson plan",
        "with modifications\nto more than half of\na lesson plan",
        "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans"
      ))
    ) |>
    ggplot(aes(
      x = 0,
      y = Percent,
      fill = lesson_modifications
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE), width = 1) +
    geom_text(aes(
      color = lesson_modifications,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "I typically use lessons with...", y = "",
      title = glue::glue("Teachers' use of lessons from district or\nschool-adopted materials (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "with no or few\nmodifications" = "#032E3F",
      "with modifications\nto less than half of\na lesson plan" = "#02587A",
      "with modifications\nto more than half of\na lesson plan" = "#0182B4",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "with no or few\nmodifications" = "white",
      "with modifications\nto less than half of\na lesson plan" = "white",
      "with modifications\nto more than half of\na lesson plan" = "black",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_blank(),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, 0)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r math-perceptions-curricula-3, fig.width = 10, fig.height = 7}
if (sum(!is.na(educator_survey$curriculum_sch_dist_1[educator_survey$content_area == "Mathematics"])) >= 1) {
  n_size <- sum(!is.na(educator_survey$curriculum_sch_dist_1[educator_survey$content_area == "Mathematics" & !str_detect(educator_survey$curriculum_sch_dist_1, "NA")]))

  educator_survey |>
    filter(content_area == "Mathematics") |>
    select(contains("curriculum_sch_dist")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "curriculum_sch_dist_1" = "The curriculum materials adopted by my school or district are well-suited to the needs of my students",
      "curriculum_sch_dist_2" = "The  curriculum materials adopted by my school or district offer students high-quality opportunities to learn.",
      "curriculum_sch_dist_3" = "The  curriculum materials adopted by my school or district are well-organized and easy to use.",
      "curriculum_sch_dist_4" = "I like the  curriculum materials adopted by my school or district.",
      "curriculum_sch_dist_5" = "The  curriculum materials adopted by my school or district will help my students learn.",
      "curriculum_sch_dist_6" = "The  curriculum materials adopted by my school are too scripted and don't provide me with enough autonomy."
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 25)) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Strongly disagree",
        "Disagree",
        "Neither agree nor disagree",
        "Agree",
        "Strongly agree"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 8
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Teacher perceptions of curriculum (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Strongly disagree" = "#040404",
      "Disagree" = "#032E3F",
      "Neither agree nor disagree" = "#02587A",
      "Agree" = "#0182B4",
      "Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Strongly disagree" = "white",
      "Disagree" = "white",
      "Neither agree nor disagree" = "black",
      "Agree" = "black",
      "Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 13.5
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -80)
    )
} else {
  no_data_plot
}
```

</center>
:::

### ELA

Teachers responded about the different curricula they use regularly and
the most often. For ELA we see the following results.

::: {.fold .o}
<center>

```{r ela-perceptions-curricula-1, fig.width = 8, fig.height = 5}
if (sum(!is.na(educator_survey$materials_1[educator_survey$content_area == "ELA/Literacy"])) >= 1) {
  n_size <- sum(!is.na(educator_survey$materials_1[educator_survey$content_area == "ELA/Literacy" & !str_detect(educator_survey$materials_1, "NA")]))

  educator_survey |>
    filter(content_area == "ELA/Literacy") |>
    select(contains("materials")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "materials_1" = "curriculum materials adopted by your district",
      "materials_2" = "materials developed by your school or district",
      "materials_3" = "materials you found on the internet",
      "materials_4" = "materials developed by yourself or with colleagues"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(
      name = html_wrap(name, 25),
      value = str_wrap(value, 20)
    ) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Never use",
        "Sometimes (once a\nmonth)",
        "Use often (once or\ntwice weekly)",
        "Use everyday"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "Please indicate the extent to which you use...", y = "",
      title = glue::glue("Teacher Curriculum Usage (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Never use" = "#032E3F",
      "Sometimes (once a\nmonth)" = "#02587A",
      "Use often (once or\ntwice weekly)" = "#0182B4",
      "Use everyday" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Never use" = "white",
      "Sometimes (once a\nmonth)" = "black",
      "Use often (once or\ntwice weekly)" = "black",
      "Use everyday" = "black"
    )) +
    guides(
      fill = guide_legend()
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    guides(color = "none") +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 16
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -150)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r ela-perceptions-curricula-2, fig.width = 8.75, fig.height = 3}
if (sum(!is.na(educator_survey$lesson_modifications[educator_survey$content_area == "ELA/Literacy"])) >= 1 & nrow(educator_survey) >= 1 & params$partner != "US_City Year") {
  n_size <- sum(!is.na(educator_survey$lesson_modifications[educator_survey$content_area == "ELA/Literacy" & !str_detect(educator_survey$lesson_modifications, "NA")]))

  educator_survey |>
    filter(content_area == "ELA/Literacy") |>
    select(lesson_modifications) |>
    drop_na() |>
    filter(!str_detect(lesson_modifications, "NA")) |>
    group_by(lesson_modifications) |>
    count(sort = T) |>
    ungroup() |>
    mutate(
      lesson_modifications = str_wrap(lesson_modifications, 20),
      Percent = round(100 * n / sum(n), 2),
      lesson_modifications = factor(lesson_modifications, levels = c(
        "with no or few\nmodifications",
        "with modifications\nto less than half of\na lesson plan",
        "with modifications\nto more than half of\na lesson plan",
        "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans"
      ))
    ) |>
    ggplot(aes(
      x = 0,
      y = Percent,
      fill = lesson_modifications
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE), width = 1) +
    geom_text(aes(
      color = lesson_modifications,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "I typically use lessons with...", y = "",
      title = glue::glue("Teachers' use of lessons from district or\nschool-adopted materials (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "with no or few\nmodifications" = "#032E3F",
      "with modifications\nto less than half of\na lesson plan" = "#02587A",
      "with modifications\nto more than half of\na lesson plan" = "#0182B4",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "with no or few\nmodifications" = "white",
      "with modifications\nto less than half of\na lesson plan" = "white",
      "with modifications\nto more than half of\na lesson plan" = "black",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_blank(),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, 0)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r ela-perceptions-curricula-3, fig.width = 10, fig.height = 7}
if (sum(!is.na(educator_survey$curriculum_sch_dist_1[educator_survey$content_area == "ELA/Literacy"])) >= 1) {
  n_size <- sum(!is.na(educator_survey$curriculum_sch_dist_1[educator_survey$content_area == "ELA/Literacy" & !str_detect(educator_survey$curriculum_sch_dist_1, "NA")]))

  educator_survey |>
    filter(content_area == "ELA/Literacy") |>
    select(contains("curriculum_sch_dist")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "curriculum_sch_dist_1" = "The curriculum materials adopted by my school or district are well-suited to the needs of my students",
      "curriculum_sch_dist_2" = "The  curriculum materials adopted by my school or district offer students high-quality opportunities to learn.",
      "curriculum_sch_dist_3" = "The  curriculum materials adopted by my school or district are well-organized and easy to use.",
      "curriculum_sch_dist_4" = "I like the  curriculum materials adopted by my school or district.",
      "curriculum_sch_dist_5" = "The  curriculum materials adopted by my school or district will help my students learn.",
      "curriculum_sch_dist_6" = "The  curriculum materials adopted by my school are too scripted and don't provide me with enough autonomy."
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 25)) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Strongly disagree",
        "Disagree",
        "Neither agree nor disagree",
        "Agree",
        "Strongly agree"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 8
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Teacher perceptions of curriculum (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Strongly disagree" = "#040404",
      "Disagree" = "#032E3F",
      "Neither agree nor disagree" = "#02587A",
      "Agree" = "#0182B4",
      "Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Strongly disagree" = "white",
      "Disagree" = "white",
      "Neither agree nor disagree" = "black",
      "Agree" = "black",
      "Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 13.5
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -80)
    )
} else {
  no_data_plot
}
```

</center>
:::

### Other

Teachers responded about the different curricula they use regularly and
the most often. For "other" (non-math or ELA) subjects we see the
following results.

::: {.fold .o}
<center>

```{r other-perceptions-curricula-1, fig.width = 8, fig.height = 5}
if (sum(!is.na(educator_survey$materials_1[educator_survey$content_area %!in% c("ELA/Literacy", "Mathematics")])) >= 1) {
  n_size <- sum(!is.na(educator_survey$materials_1[educator_survey$content_area %!in% c("ELA/Literacy", "Mathematics") & !str_detect(educator_survey$materials_1, "NA")]))

  educator_survey |>
    filter(content_area %!in% c("ELA/Literacy", "Mathematics")) |>
    select(contains("materials")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "materials_1" = "curriculum materials adopted by your district",
      "materials_2" = "materials developed by your school or district",
      "materials_3" = "materials you found on the internet",
      "materials_4" = "materials developed by yourself or with colleagues"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(
      name = html_wrap(name, 25),
      value = str_wrap(value, 20)
    ) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Never use",
        "Sometimes (once a\nmonth)",
        "Use often (once or\ntwice weekly)",
        "Use everyday"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "Please indicate the extent to which you use...", y = "",
      title = glue::glue("Teacher Curriculum Usage (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Never use" = "#032E3F",
      "Sometimes (once a\nmonth)" = "#02587A",
      "Use often (once or\ntwice weekly)" = "#0182B4",
      "Use everyday" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Never use" = "white",
      "Sometimes (once a\nmonth)" = "black",
      "Use often (once or\ntwice weekly)" = "black",
      "Use everyday" = "black"
    )) +
    guides(
      fill = guide_legend()
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    guides(color = "none") +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 16
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -150)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r other-perceptions-curricula-2, fig.width = 8.75, fig.height = 3}
if (sum(!is.na(educator_survey$lesson_modifications[educator_survey$content_area %!in% c("ELA/Literacy", "Mathematics")])) >= 1 & params$partner != "US_Digital Nest") {
  n_size <- sum(!is.na(educator_survey$lesson_modifications[educator_survey$content_area %!in% c("ELA/Literacy", "Mathematics") & !str_detect(educator_survey$lesson_modifications, "NA")]))

  educator_survey |>
    filter(content_area %!in% c("ELA/Literacy", "Mathematics")) |>
    select(lesson_modifications) |>
    drop_na() |>
    filter(!str_detect(lesson_modifications, "NA")) |>
    group_by(lesson_modifications) |>
    count(sort = T) |>
    ungroup() |>
    mutate(
      lesson_modifications = str_wrap(lesson_modifications, 20),
      Percent = round(100 * n / sum(n), 2),
      lesson_modifications = factor(lesson_modifications, levels = c(
        "with no or few\nmodifications",
        "with modifications\nto less than half of\na lesson plan",
        "with modifications\nto more than half of\na lesson plan",
        "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans"
      ))
    ) |>
    ggplot(aes(
      x = 0,
      y = Percent,
      fill = lesson_modifications
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE), width = 1) +
    geom_text(aes(
      color = lesson_modifications,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "I typically use lessons with...", y = "",
      title = glue::glue("Teachers' use of lessons from district or\nschool-adopted materials (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "with no or few\nmodifications" = "#032E3F",
      "with modifications\nto less than half of\na lesson plan" = "#02587A",
      "with modifications\nto more than half of\na lesson plan" = "#0182B4",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "with no or few\nmodifications" = "white",
      "with modifications\nto less than half of\na lesson plan" = "white",
      "with modifications\nto more than half of\na lesson plan" = "black",
      "my main materials do\nnot include lesson\nplans or I typically\ncreate my own lesson\nplans" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_blank(),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, 0)
    )
} else {
  no_data_plot
}
```

</center>
:::

::: {.fold .o}
<center>

```{r other-perceptions-curricula-3, fig.width = 10, fig.height = 7}
if (sum(!is.na(educator_survey$curriculum_sch_dist_1[educator_survey$content_area %!in% c("ELA/Literacy", "Mathematics")])) >= 1) {
  n_size <- sum(!is.na(educator_survey$curriculum_sch_dist_1[educator_survey$content_area %!in% c("ELA/Literacy", "Mathematics") & !str_detect(educator_survey$curriculum_sch_dist_1, "NA")]))

  educator_survey |>
    filter(content_area %!in% c("ELA/Literacy", "Mathematics")) |>
    select(contains("curriculum_sch_dist")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "curriculum_sch_dist_1" = "The curriculum materials adopted by my school or district are well-suited to the needs of my students",
      "curriculum_sch_dist_2" = "The  curriculum materials adopted by my school or district offer students high-quality opportunities to learn.",
      "curriculum_sch_dist_3" = "The  curriculum materials adopted by my school or district are well-organized and easy to use.",
      "curriculum_sch_dist_4" = "I like the  curriculum materials adopted by my school or district.",
      "curriculum_sch_dist_5" = "The  curriculum materials adopted by my school or district will help my students learn.",
      "curriculum_sch_dist_6" = "The  curriculum materials adopted by my school are too scripted and don't provide me with enough autonomy."
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 25)) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Strongly disagree",
        "Disagree",
        "Neither agree nor disagree",
        "Agree",
        "Strongly agree"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      color = value,
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 8
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Teacher perceptions of curriculum (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Strongly disagree" = "#040404",
      "Disagree" = "#032E3F",
      "Neither agree nor disagree" = "#02587A",
      "Agree" = "#0182B4",
      "Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Strongly disagree" = "white",
      "Disagree" = "white",
      "Neither agree nor disagree" = "black",
      "Agree" = "black",
      "Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -40, b = 0),
        size = 13.5
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -80)
    )
} else {
  no_data_plot
}
```

</center>
:::


## Section 4c: Educators' Perceptions of School Culture and Climate

### Teachers' Perceptions of School Leaders and CBPL

Teachers responded to items about their perceptions of school leaders
and PL environment.

::: {.fold .o}
<center>

```{r teacher-perceptions-leaders, fig.width = 12, fig.height = 8.5}
if (sum(!is.na(educator_survey$`ts_perceptions_sl_1`)) >= 1) {
  
  n_size <- sum(!is.na(educator_survey$`ts_perceptions_sl_1`))
  
  educator_survey |>
    select(contains("ts_perceptions_sl")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "ts_perceptions_sl_1" = "My school leaders attend the professional development related to curriculum materials with us",
      "ts_perceptions_sl_2" = "My school leaders have created a shared vision for instruction that my curriculum-related professional development experiences is helping our school to implement",
      "ts_perceptions_sl_3" = "My school leaders make sure I have access to all the materials and resources I need to implement our adopted curriculum",
      "ts_perceptions_sl_4" = "My school leaders press me to implement the ideas I learn in curriculum-related professional development",
      "ts_perceptions_sl_5" = "My school leaders make time for my curriculum-related professional development.",
      "ts_perceptions_sl_6" = "Instructional guidance in my school conflicts with the approach taken in curriculum-aligned professional development",
      "ts_perceptions_sl_7" = "I sometimes feel pressure to teach in ways not aligned with the approach to instruction taken in curriculum-aligned professional development",
      "ts_perceptions_sl_8" = "Sometimes I feel like my school puts up barriers to implementing the things I learn in curriculum-related PL"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 35)) |>
    group_by(name) |>
    mutate(
      Percent = round(100 * n / sum(n), 2),
      value = factor(value, levels = c(
        "Not at all",
        "Rarely",
        "Sometimes",
        "Often",
        "All the time"
      ))
    ) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Educators’ Perceptions of School Leaders (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "Not at all" = "#040404",
      "Rarely" = "#032E3F",
      "Sometimes" = "#02587A",
      "Often" = "#0182B4",
      "All the time" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "Not at all" = "white",
      "Rarely" = "white",
      "Sometimes" = "black",
      "Often" = "black",
      "All the time" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -55, b = 0),
        size = 14
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -50)
    )
} else {
  no_data_plot
}
```

</center>
:::

### Teachers' Perceptions of School Environment

Teachers responded to items about their school environment.

::: {.fold .o}
<center>

```{r teacher-perceptions-environment, fig.width = 12, fig.height = 6}
if (sum(!is.na(educator_survey$`school_environment_1`)) >= 1) {
  
  n_size <- sum(!is.na(educator_survey$`school_environment_1`))
  
  educator_survey |>
    select(contains("school_environment")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "school_environment_1" = "I trust my fellow teachers in the school",
      "school_environment_2" = "I feel connected to my fellow teachers in the school",
      "school_environment_3" = "I have influence over the professional learning that I receive through my school or district"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 25)) |>
    group_by(name) |>
    mutate(Percent = round(100 * n / sum(n), 2)) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Educators’ Perceptions of School Culture and Climate (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1 - Strongly disagree" = "#040404",
      "2 - Disagree" = "#032E3F",
      "3 - Neither agree nor disagree" = "#02587A",
      "4 - Agree" = "#0182B4",
      "5 - Strongly agree" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1 - Strongly disagree" = "white",
      "2 - Disagree" = "white",
      "3 - Neither agree nor disagree" = "black",
      "4 - Agree" = "black",
      "5 - Strongly agree" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl(legend = T) +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -55, b = 0),
        size = 16
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -150)
    )
} else {
  no_data_plot
}
```

</center>
:::

# Section 5: School Leaders' Mindsets & Observational Practices

Participants complete Teaching Lab’s Educator Survey twice a year: at the beginning and end of their participation in PL. The survey collects data on school leaders’ mindsets and self-reported observational practices.

## Section 5a: School Leaders - Mindsets

School leaders responded to several items about mindsets, related to recognizing race and culture, the need for remediation, high expectations for all students, and growth mindsets on a 5-point Likert scale. Composite measures were created for each construct by reverse coding some items and then averaging responses across items. In this way, higher scores correspond to holding equitable mindsets.

### Overall

::: {.fold .o}
<center>

```{r school-leaders-mindsets-overall, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`non_ts_mindsets_2`)) >= 1) {
  n_size <- sum(!is.na(educator_survey$`non_ts_mindsets_2`))

  leader_mindsets <- educator_survey |>
    select(contains("non_ts_mindsets")) |>
    mutate(across(everything(), ~ as.character(.x))) |>
    pivot_longer(everything()) |>
    drop_na(value) |>
    mutate(name = str_replace_all(name, c(
      "non_ts_mindsets_2" = "The gap in the achievement among students of different races is about poverty, not race",
      "non_ts_mindsets_3" = "I think about my own background and experiences and how those affect my instructional leadership",
      "non_ts_mindsets_4" = "Teachers should try to keep in mind the limits of students’ ability and give them assignments that they know they can do so that they do not become discouraged",
      "non_ts_mindsets_5" = "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
      "non_ts_mindsets_6" = "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
      "non_ts_mindsets_7" = "Teachers should provide all students the opportunity to work with grade-level texts and tasks",
      "non_ts_mindsets_8" = "Students of all ethnic or cultural backgrounds can be successful in my school/district",
      "non_ts_mindsets_9" = "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my school/district",
      "non_ts_mindsets_10" = "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my school/district",
      "non_ts_mindsets_11" = "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
      "non_ts_mindsets_12" = "Students who come into my school/district behind grade level will have a hard time succeeding",
      "non_ts_mindsets_13" = "Students have a certain amount of intelligence, and they can’t really do much to change it",
      "non_ts_mindsets_14" = "Intelligence is something about students that they can’t change very much",
      "non_ts_mindsets_15" = "Students can learn new things, but they can’t really change their basic intelligence",
      "non_ts_mindsets_1" = "Teachers should be color blind when it comes to their teaching - they shouldn't think of students in terms of their race or ethnicity"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup()

  leader_mindsets |>
    mutate(
      pos_neg = case_when(
        str_detect(name, "race") ~ "negative",
        name %in% c("Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
      "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
      "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
      "Students who come into my school/district behind grade level will have a hard time succeeding",
      "Teachers should try to keep in mind the limits of students’ ability and give them assignments that they know they can do so that they do not become discouraged",
      "Intelligence is something about students that they can’t change very much",
      "Students can learn new things, but they can’t really change their basic intelligence",
      "Students have a certain amount of intelligence, and they can’t really do much to change it") ~ "negative",
        TRUE ~ "positive"
      ),
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      ` ` = case_when(
        str_detect(name, "race|own background") ~ "Recognition of Race & Culture",
        name %in% c(
          "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
          "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
          "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
          "Students who come into my school/district behind grade level will have a hard time succeeding",
          "Teachers should try to keep in mind the limits of students’ ability and give them assignments that they know they can do so that they do not become discouraged"
        ) ~ "Need for Remediation",
        name %in% c(
          "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my school/district",
          "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my school/district",
          "Students of all ethnic or cultural backgrounds can be successful in my school/district",
          "Teachers should provide all students the opportunity to work with grade-level texts and tasks"
        ) ~ "High Expectations",
        name %in% c(
          "Intelligence is something about students that they can’t change very much",
          "Students can learn new things, but they can’t really change their basic intelligence",
          "Students have a certain amount of intelligence, and they can’t really do much to change it"
        ) ~ "Growth Mindsets"
      )
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(
      score = sum(score),
      ` ` = min(` `)
    ) |>
    ungroup() |>
    mutate(` ` = factor(` `, levels = c("Recognition of Race & Culture",
                                        "Need for Remediation",
                                        "High Expectations",
                                        "Growth Mindsets"))) |>
    group_by(` `) |>
    summarise(Score = mean(score)) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_admin_mindsets_overall.png"))

  knitr::include_graphics(here::here("images/report_images/tab_admin_mindsets_overall.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Recognition of Race & Culture

::: {.fold .o}
<center>

```{r school-leaders-mindsets-1, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`non_ts_mindsets_2`)) >= 1) {
  n_size <- sum(!is.na(educator_survey$`non_ts_mindsets_2`))

  leader_mindsets <- educator_survey |>
    select(contains("non_ts_mindsets")) |>
    mutate(across(everything(), ~ as.character(.x))) |>
    pivot_longer(everything()) |>
    drop_na(value) |>
    mutate(name = str_replace_all(name, c(
      "non_ts_mindsets_2" = "The gap in the achievement among students of different races is about poverty, not race",
      "non_ts_mindsets_3" = "I think about my own background and experiences and how those affect my instructional leadership",
      "non_ts_mindsets_4" = "Teachers should try to keep in mind the limits of students’ ability and give them assignments that they know they can do so that they do not become discouraged",
      "non_ts_mindsets_5" = "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
      "non_ts_mindsets_6" = "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
      "non_ts_mindsets_7" = "Teachers should provide all students the opportunity to work with grade-level texts and tasks",
      "non_ts_mindsets_8" = "Students of all ethnic or cultural backgrounds can be successful in my school/district",
      "non_ts_mindsets_9" = "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my school/district",
      "non_ts_mindsets_10" = "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my school/district",
      "non_ts_mindsets_11" = "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
      "non_ts_mindsets_12" = "Students who come into my school/district behind grade level will have a hard time succeeding",
      "non_ts_mindsets_13" = "Students have a certain amount of intelligence, and they can’t really do much to change it",
      "non_ts_mindsets_14" = "Intelligence is something about students that they can’t change very much",
      "non_ts_mindsets_15" = "Students can learn new things, but they can’t really change their basic intelligence",
      "non_ts_mindsets_1" = "Teachers should be color blind when it comes to their teaching - they shouldn't think of students in terms of their race or ethnicity"
    ))) |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() #|>
  # mutate(name = html_wrap(name, 40)) |>
  # group_by(name) |>
  # mutate(Percent = round(100 * n / sum(n), 2))

  # teacher_mindsets_1 <- teacher_mindsets |>

  leader_mindsets |>
    filter(str_detect(name, "color blind|own background|in the achievement")) |>
    mutate(
      pos_neg = case_when(
        str_detect(name, "race") ~ "negative",
        TRUE ~ "positive"
      ),
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_admin_mindsets_1.png"))

  knitr::include_graphics(here::here("images/report_images/tab_admin_mindsets_1.png"))
  # ggplot(aes(
  #   x = fct_reorder(name, Percent, .desc = T),
  #   y = Percent,
  #   color = value,
  #   fill = value
  # )) +
  # geom_col(color = NA, position = position_stack(reverse = TRUE)) +
  # geom_text(aes(
  #   label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
  # ),
  # position = position_stack(vjust = 0.5, reverse = TRUE),
  # fontface = "bold",
  # size = 9
  # ) +
  # labs(
  #   x = "", y = "",
  #   title = glue::glue("School Leaders' Recognition of Race & Culture (n = {n_size})"),
  #   fill = ""
  # ) +
  # scale_fill_manual(values = c(
  #   "1 - Strongly disagree" = "#040404",
  #   "2 - Disagree" = "#032E3F",
  #   "3 - Neither agree nor disagree" = "#02587A",
  #   "4 - Agree" = "#0182B4",
  #   "5 - Strongly agree" = "#00ACF0"
  # )) +
  # scale_color_manual(values = c(
  #   "1 - Strongly disagree" = "white",
  #   "2 - Disagree" = "black",
  #   "3 - Neither agree nor disagree" = "black",
  #   "4 - Agree" = "black",
  #   "5 - Strongly agree" = "black"
  # )) +
  # guides(
  #   fill = guide_legend(),
  #   color = "none"
  # ) +
  # scale_y_continuous(
  #   labels = scales::label_percent(scale = 1),
  #   expand = c(0.14, 0)
  # ) +
  # coord_flip() +
  # theme_tl() +
  # theme(
  #   axis.text.y = element_markdown(
  #     margin = margin(t = 0, l = 0, r = -55, b = 0),
  #     size = 20
  #   ),
  #   axis.text.x = element_blank(),
  #   plot.title = element_text(size = 25, face = "bold"),
  #   legend.position = "bottom",
  #   legend.key.height = unit(1.3, "cm"),
  #   legend.key.width = unit(1.3, "cm"),
  #   legend.key.size = unit(0.75, "cm"),
  #   legend.text = element_text(size = 13),
  #   legend.margin = margin(-25, 0, 0, -85)
  # )
} else {
  no_data_plot
}
```

</center>
:::

### Need for Remediation

::: {.fold .o}
<center>

```{r school-leaders-mindsets-2, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`non_ts_mindsets_2`)) >= 1) {
  leader_mindsets |>
    filter(name %in% c(
      "Before students are asked to engage in complex learning tasks, they need to have a solid grasp of basic skills",
      "Grouping students of different levels of achievement for instruction may benefit some students, but it can undermine the progress that could otherwise be made by higher achieving students",
      "It is not fair to ask students who are struggling with English to take on challenging academic assignments",
      "Students who come into my school/ district behind grade level will have a hard time succeeding",
      "Teachers should try to keep in mind the limits of students’ ability and give them assignments that they know they can do so that they do not become discouraged"
    )) |>
    mutate(
      pos_neg = "negative",
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_admin_mindsets_2.png"))

  knitr::include_graphics(here::here("images/report_images/tab_admin_mindsets_2.png"))
} else {
  no_data_plot
}
```

</center>
:::

### High Expectations

::: {.fold .o}
<center>

```{r school-leaders-mindsets-3, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`non_ts_mindsets_2`)) >= 1) {
  leader_mindsets |>
    filter(name %in% c(
      "Students of all ethnic or cultural backgrounds are able to meet the expectations for higher order skills in my school/district",
      "Students of all ethnic or cultural backgrounds are capable of solving problems by using critical thinking in my school/district",
      "Students of all ethnic or cultural backgrounds can be successful in my school/district",
      "Teachers should provide all students the opportunity to work with grade-level texts and tasks"
    )) |>
    mutate(
      pos_neg = "positive",
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_admin_mindsets_3.png"))

  knitr::include_graphics(here::here("images/report_images/tab_admin_mindsets_3.png"))
} else {
  no_data_plot
}
```

</center>
:::

### Growth Mindsets

::: {.fold .o}
<center>

```{r school-leaders-mindsets-4, fig.width = 12, fig.height = 12}
if (sum(!is.na(educator_survey$`non_ts_mindsets_14`)) >= 1) {
  leader_mindsets |>
    filter(name %in% c(
      "Intelligence is something about students that they can’t change very much",
      "Students can learn new things, but they can’t really change their basic intelligence",
      "Students have a certain amount of intelligence, and they can’t really do much to change it"
    )) |>
    mutate(
      pos_neg = "negative",
      score_multiplier = case_when(
        value == "1 - Strongly disagree" & pos_neg == "negative" ~ 1,
        value == "1 - Strongly disagree" & pos_neg == "positive" ~ 0,
        value == "2 - Disagree" & pos_neg == "negative" ~ 0.75,
        value == "2 - Disagree" & pos_neg == "positive" ~ 0.25,
        value == "3 - Neither agree nor disagree" & pos_neg == "negative" ~ 0.5,
        value == "3 - Neither agree nor disagree" & pos_neg == "positive" ~ 0.5,
        value == "4 - Agree" & pos_neg == "negative" ~ 0.25,
        value == "4 - Agree" & pos_neg == "positive" ~ 0.75,
        value == "5 - Strongly agree" & pos_neg == "negative" ~ 0,
        value == "5 - Strongly agree" & pos_neg == "positive" ~ 1
      ),
      name = if_else(pos_neg == "negative", paste0("<p style='color:red;'>", name, "</p>"), name)
    ) |>
    group_by(name) |>
    mutate(score = (n * score_multiplier) / sum(n)) |>
    summarise(score = sum(score)) |>
    rename(` ` = name, Score = score) %>%
    add_row(` ` = "<b>Overall score</b>", !!!colMeans(.[-1]), .before = 1) |>
    gt::gt() |>
    gt::fmt_percent(Score,
      scale_values = TRUE
    ) |>
    gt::fmt_markdown(` `) |>
    gt::data_color(
      columns = Score,
      colors = scales::col_bin(
        palette = c(
          TeachingLab::tl_palette(n = 8, color = "blue") |> magrittr::extract(c(4, 6, 8))
        ),
        domain = c(0, 1),
        bins = c(0, 0.39, 0.79, 1)
      )
    ) |>
    TeachingLab::gt_theme_tl(align = "left") |>
    gt::tab_footnote(footnote = paste0("n = ", n_size)) |>
    gtsave(here::here("images/report_images/tab_admin_mindsets_4.png"))

  knitr::include_graphics(here::here("images/report_images/tab_admin_mindsets_4.png"))
} else {
  no_data_plot
}
```

</center>
:::

## Section 5b: School Leaders - Observational Practices

School leaders responded to items about the focus of their observational practices.

::: {.fold .o}
<center>

```{r school-leaders-observation, fig.width = 12, fig.height = 7}
if (sum(!is.na(educator_survey$`observation_practice_1`)) >= 1) {
  educator_survey |>
    select(contains("observation_practice")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "observation_practice_1" = "Whether the lesson is focused on a high-quality text or task",
      "observation_practice_2" = "Whether the questions and tasks address the analytical thinking required by the grade-level standards",
      "observation_practice_3" = "Whether all students have opportunities to engage in the work of the lesson"
    ))) |>
    filter(value != "N/A - I do not observe teachers in my role.") |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 25)) |>
    group_by(name) |>
    mutate(Percent = round(100 * n / sum(n), 2)) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("How often does your teacher practice observation focus on...\n(n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1- Almost never" = "#040404",
      "2 - Rarely" = "#032E3F",
      "3- Sometimes" = "#02587A",
      "4 - Very often" = "#0182B4",
      "5 - Almost always" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1- Almost never" = "white",
      "2 - Rarely" = "black",
      "3- Sometimes" = "black",
      "4 - Very often" = "black",
      "5 - Almost always" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl() +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -55, b = 0),
        size = 17
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -60)
    )
} else {
  no_data_plot
}
```

</center>
:::

# Section 6: Teachers' Instructional Practices

Teachers report on their instructional practices in the Educator Survey and some are observed by Teaching Lab staff.

## Section 6a: Teachers' CRSE Self-Reported Practices

Participants complete Teaching Lab’s Educator Survey twice a year: at the beginning and end of their participation in PL. The survey collects data on self-reported culturally responsive and sustaining education (CRSE) practices.

::: {.fold .o}
<center>

```{r crse-reported-practices, fig.width = 12, fig.height = 7}
if (sum(!is.na(educator_survey$`ts_crse_after_7/30_1`)) >= 1) {
  educator_survey |>
    select(contains("ts_crse_after")) |>
    pivot_longer(everything()) |>
    mutate(name = str_replace_all(name, c(
      "ts_crse_after_7/30_1" = "I adapt instruction to meet the needs of my students",
      "ts_crse_after_7/30_2" = "I identify ways that the school culture (e.g., values, norms, and practices) is different from my students’ home culture",
      "ts_crse_after_7/30_3" = "I use my students’ prior knowledge to help them make sense of new information",
      "ts_crse_after_7/30_4" = "I revise instructional material to include a better representation of cultural groups"
    ))) |>
    filter(value != "N/A - I do not observe teachers in my role.") |>
    group_by(name, value) |>
    count(sort = T) |>
    ungroup() |>
    drop_na(value) |>
    mutate(name = html_wrap(name, 25)) |>
    group_by(name) |>
    mutate(Percent = round(100 * n / sum(n), 2)) |>
    ggplot(aes(
      x = fct_reorder(name, Percent, .desc = T),
      y = Percent,
      color = value,
      fill = value
    )) +
    geom_col(color = NA, position = position_stack(reverse = TRUE)) +
    geom_text(aes(
      label = if_else(Percent >= 10, paste0(round(Percent), "%"), "")
    ),
    position = position_stack(vjust = 0.5, reverse = TRUE),
    fontface = "bold",
    size = 6
    ) +
    labs(
      x = "", y = "",
      title = glue::glue("Teachers CRSE Self-reported Practices (n = {n_size})"),
      fill = ""
    ) +
    scale_fill_manual(values = c(
      "1- Never" = "#040404",
      "2- Rarely" = "#032E3F",
      "3- Sometimes" = "#02587A",
      "4- Often" = "#0182B4",
      "5- Very often" = "#00ACF0"
    )) +
    scale_color_manual(values = c(
      "1- Never" = "white",
      "2- Rarely" = "black",
      "3- Sometimes" = "black",
      "4- Often" = "black",
      "5- Very often" = "black"
    )) +
    guides(
      fill = guide_legend(),
      color = "none"
    ) +
    scale_y_continuous(
      labels = scales::label_percent(scale = 1),
      expand = c(0.14, 0)
    ) +
    coord_flip() +
    theme_tl() +
    theme(
      axis.text.y = element_markdown(
        margin = margin(t = 0, l = 0, r = -55, b = 0),
        size = 17
      ),
      axis.text.x = element_blank(),
      plot.title = element_text(size = 25, face = "bold"),
      legend.position = "bottom",
      legend.key.height = unit(1.3, "cm"),
      legend.key.width = unit(1.3, "cm"),
      legend.key.size = unit(0.75, "cm"),
      legend.text = element_text(size = 13),
      legend.margin = margin(-25, 0, 0, -40)
    )
} else {
  no_data_plot
}
```

</center>
:::

## Section 6b: Classroom Observations

Teaching Lab has the opportunity to observe some participants over the course of their participation in PL. Below are the results of the initial classroom observations conducted using the IPG Math and ELA Tools, in addition to the FSOT.  Ratings of 3 and 4 on 4-point Likert scales and Yes on a Yes/No items were considered positive.

### Overall Positive Indicators

::: {.fold .o}
<center>

```{r teacher-instructional-practices-1, fig.width = 5, fig.height = 6}
if (nrow(ipg_forms) >= 1) {

  ### Idk what scoring since this isn't done ###
  tn_foundational_skills <- ipg_forms |>
    filter(Finished == TRUE) |>
    select(
      `tn_4_1`, `tn_4_2`, `tn_4_3`, `tn_4_4`, `tn_4_5`, `tn_4_6`,
      `tn_6`, `tn_7`, `tn_8`, `tn_9`, `tn_10`, `tn_12`, `tn_13`, `tn_14`
    ) |>
    mutate(
      across(everything(), ~ as.character(.x)),
      across(everything(), ~ na_if(.x, "NA"))
    ) |>
    janitor::remove_empty("rows")

  ### Mix of yes-no and 1-4 Scale Scoring ###
  k_12_math <- ipg_forms |>
    filter(Finished == TRUE) |>
    select(
      k12_m_ca1a, k12_m_ca1b, k12_m_ca1c, # Core Action 1 yes-no
      k12_m_ca2a, k12_m_ca2b, k12_m_ca2c, k12_m_ca2d, # Core Action 2 1-4
      k12_m_ca3a, k12_m_ca3b, k12_m_ca3c, k12_m_ca3d, k12_m_ca3e
    ) |> # Core Action 3 1-4
    mutate(
      across(everything(), ~ as.character(.x)),
      across(everything(), ~ na_if(.x, "NA"))
    ) |>
    janitor::remove_empty("rows") |>
    summarise(
      across(c(k12_m_ca1a, k12_m_ca1b, k12_m_ca1c), ~ grade_ipg(.x, type = "character")),
      across(c(
        k12_m_ca2a, k12_m_ca2b, k12_m_ca2c, k12_m_ca2d,
        k12_m_ca3a, k12_m_ca3b, k12_m_ca3c, k12_m_ca3d, k12_m_ca3e
      ), ~ grade_ipg(.x, type = "numeric"))
    ) |>
    pivot_longer(everything()) |>
    mutate(`Core Action` = c(
      "Core Action 1", "Core Action 1", "Core Action 1",
      "Core Action 2", "Core Action 2", "Core Action 2", "Core Action 2",
      "Core Action 3", "Core Action 3", "Core Action 3", "Core Action 3", "Core Action 3"
    )) |>
    group_by(`Core Action`) |>
    summarise(value = mean(value))

  ### Mix of yes-no and 1-4 scoring ###
  k_12_ela <- ipg_forms |>
    filter(Finished == TRUE) |>
    select(
      k12_ela_ca1a, k12_ela_ca1b, k12_ela_ca1c, # Core Action 1, Yes/No
      k12_ela_ca2a, k12_ela_ca2b, k12_ela_ca2c, k12_ela_ca2d, # Core Action 2, 1-4
      k12_ela_ca3a, k12_ela_ca3b, k12_ela_ca3c, k12_ela_ca3d, k12_ela_ca3e, k12_ela_ca3f
    ) |> # Core Action 3, 1-4
    mutate(
      across(everything(), ~ as.character(.x)),
      across(everything(), ~ na_if(.x, "NA"))
    ) |>
    janitor::remove_empty("rows") |>
    summarise(
      across(c(k12_ela_ca1a, k12_ela_ca1b, k12_ela_ca1c), ~ grade_ipg(.x, type = "character")),
      across(c(
        k12_ela_ca2a, k12_ela_ca2b, k12_ela_ca2c, k12_ela_ca2d,
        k12_ela_ca3a, k12_ela_ca3b, k12_ela_ca3c, k12_ela_ca3d, k12_ela_ca3e, k12_ela_ca3f
      ), ~ grade_ipg(.x, type = "numeric"))
    ) |>
    pivot_longer(everything()) |>
    mutate(`Core Action` = c(
      "Core Action 1", "Core Action 1", "Core Action 1",
      "Core Action 2", "Core Action 2", "Core Action 2", "Core Action 2",
      "Core Action 3", "Core Action 3", "Core Action 3", "Core Action 3", "Core Action 3", "Core Action 3"
    )) |>
    group_by(`Core Action`) |>
    summarise(value = mean(value))

  ### Mix of 1-4 and 1-3 scoring ###
  fsot <- ipg_forms |>
    filter(Finished == TRUE) |>
    select(
      fsot_ac1, fsot_ac2, # AC1/AC2, 1-4, Q69 is not 1-4
      fsot_td1, fsot_td2, fsot_td3, fsot_td4, # TD, 1-4
      fsot_sp1, fsot_sp2, fsot_sp3, fsot_sp4, # SP, 1-4
      fsot_ad1, fsot_ad2
    ) |> # AD1/AD2, 1-3
    mutate(
      across(everything(), ~ as.character(.x)),
      across(everything(), ~ na_if(.x, "NA"))
    ) |>
    janitor::remove_empty("rows") |>
    summarise(
      across(c(
        fsot_ac1, fsot_ac2,
        fsot_td1, fsot_td2, fsot_td3, fsot_td4,
        fsot_sp1, fsot_sp2, fsot_sp3, fsot_sp4
      ), ~ grade_ipg(.x, type = "numeric")),
      across(c(fsot_ad1, fsot_ad2), ~ grade_ipg(.x, type = "numeric_low"))
    ) |>
    pivot_longer(everything()) |>
    mutate(`Core Action` = c(
      "Aligned Content", "Aligned Content",
      "Teacher-Directed\nInstruction", "Teacher-Directed\nInstruction", "Teacher-Directed\nInstruction", "Teacher-Directed\nInstruction",
      "Student Practice", "Student Practice", "Student Practice", "Student Practice",
      "Assessment &\nDifferentiation", "Assessment &\nDifferentiation"
    )) |>
    group_by(`Core Action`) |>
    summarise(value = mean(value))

  fsot_n_size <- sum(!is.na(ipg_forms$fsot_ac1[!str_detect(ipg_forms$fsot_ac1, "NA")]))
  ipg_math_n_size <- sum(!is.na(ipg_forms$fsot_ac1[!str_detect(ipg_forms$k12_m_ca1a, "NA")]))
  ipg_ela_n_size <- sum(!is.na(ipg_forms$fsot_ac1[!str_detect(ipg_forms$k12_ela_ca1a, "NA")]))

  math_plot <- k_12_math %>%
    add_row(`Core Action` = "Overall", !!!colMeans(.[-1]), .before = 1) |>
    ggplot(aes(x = `Core Action`, y = value, fill = `Core Action`)) +
    geom_col() +
    geom_text(aes(label = paste0(round(value), "%")),
      fontface = "bold",
      vjust = -1
    ) +
    scale_fill_manual(values = sample(tl_palette(color = "blue", n = 10)[2:9], 4)) +
    scale_y_continuous(
      labels = scales::percent_format(scale = 1),
      limits = c(0, 100)
    ) +
    labs(
      x = "", y = "",
      title = "% Positive Indicators K-12 Math IPG"
    ) +
    theme_tl()

  ela_plot <- k_12_ela %>%
    add_row(`Core Action` = "Overall", !!!colMeans(.[-1]), .before = 1) |>
    ggplot(aes(x = `Core Action`, y = value, fill = `Core Action`)) +
    geom_col() +
    geom_text(aes(label = paste0(round(value), "%")),
      fontface = "bold",
      vjust = -1
    ) +
    scale_fill_manual(values = sample(tl_palette(color = "blue", n = 10)[2:9], 4)) +
    scale_y_continuous(
      labels = scales::percent_format(scale = 1),
      limits = c(0, 100)
    ) +
    labs(
      x = "", y = "",
      title = "% Positive Indicators K-12 ELA IPG"
    ) +
    theme_tl()

  fsot_plot <- fsot %>%
    add_row(`Core Action` = "Overall", !!!colMeans(.[-1]), .before = 1) |>
    mutate(`Core Action` = factor(`Core Action`, levels = c(
      "Aligned Content",
      "Assessment &\nDifferentiation",
      "Student Practice",
      "Teacher-Directed\nInstruction",
      "Overall"
    ))) |>
    ggplot(aes(x = `Core Action`, y = value, fill = `Core Action`)) +
    geom_col() +
    geom_text(aes(label = paste0(round(value), "%")),
      fontface = "bold",
      vjust = -1
    ) +
    scale_fill_manual(values = sample(tl_palette(color = "blue", n = 12)[2:11], 5)) +
    scale_y_continuous(
      labels = scales::percent_format(scale = 1),
      limits = c(0, 100)
    ) +
    labs(
      x = "", y = "",
      title = "% Positive Indicators Foundational\nSkills Observational Tool"
    ) +
    theme_tl()

  k_12_math |>
    bind_rows(k_12_ela) |>
    bind_rows(fsot) |>
    summarise(value = mean(value, na.rm = T)) |>
    ggplot(aes(x = 0, y = value)) +
    geom_col(fill = "#04abeb") +
    geom_text(aes(label = paste0(round(value), "%")),
      fontface = "bold",
      vjust = -1
    ) +
    scale_y_continuous(
      labels = scales::percent_format(scale = 1),
      limits = c(0, 100)
    ) +
    labs(
      x = "", y = "",
      title = "% Positive Indicators Across\nAll Observation Rubrics"
    ) +
    theme_tl() +
    theme(axis.text.x = element_blank())
} else {
  no_data_plot
}
```

</center>
:::

### Math

::: {.fold .o}
<center>

```{r teacher-instructional-practices-2, fig.width = 8, fig.height = 6}
if (nrow(ipg_forms[ipg_forms$content_area == "Math" & !str_detect(ipg_forms$content_area, "NA"), ]) >= 1) {
  math_plot
} else {
  no_data_plot
}
```

</center>
:::

### ELA

::: {.fold .o}
<center>

```{r teacher-instructional-practices-3, fig.width = 8, fig.height = 6}
if (nrow(ipg_forms[ipg_forms$content_area == "ELA" & !str_detect(ipg_forms$content_area, "NA"), ]) >= 1) {
  ela_plot
} else {
  no_data_plot
}
```

</center>
:::

### K-2 ELA

::: {.fold .o}
<center>

```{r teacher-instructional-practices-4, fig.width = 8, fig.height = 6}
if (nrow(ipg_forms[ipg_forms$content_area == "K-2 Early Literacy (Foundational Skills)" & !str_detect(ipg_forms$content_area, "NA"), ]) >= 1) {
  fsot_plot
} else {
  no_data_plot
}
```

</center>
:::

# Section 7: Student Outcomes

Some teachers will administer a student survey to at least one of their groups. Using 5-point Likert-type scales, students will respond to items related to their teachers’ engagement in CRSE practices, teacher-student relationships, self-efficacy, happiness and sense of belonging, and being challenged. No data yet, but soon to come!

::: {.fold .o}
<center>

```{r student-outcomes, fig.width = 12, fig.height = 12}
no_data_plot
```

</center>
:::
